<?xml version="1.0" encoding="UTF-8"?>

<launcher>
    <!-- Default Agent and Host Setup -->
    <variable name="host-remote" default-value="127.0.0.1" />
    <variable name="host-activemq" default-value="127.0.0.1:61616" />
    <variable name="agent-count" default-value="2" />

    <!-- Run Script Variables -->
    <variable name="run-param">
        <platform type="fuse" value=" --activemq={host-activemq}"/>
        <platform type="mule" value=" --activemq={host-activemq}"/>
    </variable>
    <variable name="run" default-value="./{platform}.{extension}{run-param}" />

    <!-- Setup Launcher Instances - executed sequentially in the order of appearance -->
    <instance id="jvm1" type="local">
        {run} --agent=s --type=sender --count={agent-count}
    </instance>
    <instance id="jvm2" type="remote" host="{host-remote}" require="jvm1">
        {run} --agent=r --type=receiver --count={agent-count} --join
    </instance>

    <!-- Instrutions -->
    <cycle count="3">
        <step>
            <command for="jvm1">send r{agent-id} Hello</command>
        </step>
        <sleep duration="1000" />
    </cycle>

    <step>
        <command>quit</command>
    </step>

</launcher>