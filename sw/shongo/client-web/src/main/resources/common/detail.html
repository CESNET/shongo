<h1>Detail of reservation request for [%- technologies -%]
[%- IF request.specification.class == 'RoomSpecification' %] room capacity
[%- ELSIF request.specification.class == 'AliasSpecification' || request.specification.class == 'AliasSetSpecification' %] alias
[%- END -%]
</h1>

<script type="text/javascript">
    window.showNode = function(nodeId, show) {
        var stateReport = document.getElementById(nodeId);
        if ( show == null ) {
            show = stateReport.style.display == 'none';
        }
        stateReport.style.display = show ? 'block' : 'none';
    };
    $(function () {
        $(".state-not-allocated"    ).tooltip({ title: "[% resources.request.state.notAllocated %]" });
        $(".state-allocated"        ).tooltip({ title: "[% resources.request.state.allocated %]" });
        $(".state-finished"         ).tooltip({ title: "[% resources.request.state.finished %]" });
        $(".state-allocation-failed").tooltip({ title: "[% resources.request.state.allocationFailed %]" });
        $(".state-starting-failed"  ).tooltip({ title: "[% resources.request.state.startingFailed %]" });
        $(".role-owner"             ).tooltip({ title: "[% resources.security.role.owner %]" });
        $(".role-reservationUser"   ).tooltip({ title: "[% resources.security.role.reservationUser %]" });
    });
</script>

<dl class="dl-horizontal">

    <dt>Identifier:</dt>
    <dd>[% request.id %]</dd>

    <dt>Description:</dt>
    <dd>[% request.description %]</dd>

    <dt>Purpose:</dt>
    <dd>[% request.purpose %]</dd>

[%- IF request.specification.class == 'RoomSpecification' -%]

    <dt>Start date/time:</dt>
    <dd>[% util.datetime_format(request.start) %]</dd>

    <dt>Duration:</dt>
    <dd>[% util.period_format(request.duration) %]</dd>

    <dt>Periodicity:</dt>
    <dd>[% request.periodicity %] [% IF request.periodicityEnd %](end: [% util.datetime_partial_format(request.periodicityEnd) %])[% END %]</dd>
    [%- aliasReservation = request.providedReservations.0 %]
    [%- IF aliasReservation %]

    <dt>Room Alias:</dt>
    <dd><a href="[% location %]/detail?id=[% aliasReservation.reservationRequestId %]">[% aliasReservation.roomName %]</a> (valid in [% util.interval_format_date(aliasReservation.slot) %])</dd>
    [% END %]

    <dt>Number of participants:</dt>
    <dd>[% request.participantCount %]</dd>

[%- ELSIF request.specification.class == 'AliasSpecification' || request.specification.class == 'AliasSetSpecification' -%]

    [% childRequest = request.childRequests.0 -%]

    <dt>Validity:</dt>
    <dd>[% util.datetime_format_date(request.start) %]/[% util.datetime_format_date(request.end) %]</dd>

    <dt>State:</dt>
    <dd>
        [%- IF childRequest.stateReport -%]
            [% childRequest.stateReport = '<pre>' _ childRequest.stateReport _ '</pre>' %]
        [%- END -%]
        [%- INCLUDE common/text_with_tooltip.html
                class        = 'state-' _ childRequest.stateCode
                text         = childRequest.state _ '<div class="info-icon"></div>'
                tooltipId    = 'state-report-' _ loop.index
                tooltipClass = 'state-report'
                tooltipText  = childRequest.stateReport
        -%]
    </dd>

    <dt>Room Name:</dt>
    <dd>[% childRequest.reservation.roomName %][% '<span class="empty">None</span>' IF !childRequest.reservation.roomName %]</dd>

    <dt>Allocated Alias(es):</dt>
    <dd>
        [% INCLUDE common/text_with_tooltip.html
                text         = childRequest.reservation.aliases
                tooltipId    = 'aliases-description-' _ loop.index
                tooltipClass = 'aliases-description'
                tooltipText  = childRequest.reservation.aliasesDescription
        -%]
        [% '<span class="empty">None</span>' IF !childRequest.reservation.aliases %]
    </dd>

[%- END -%]

[%- FOREACH attribute IN request.attributes %]

    <dt>[% attribute.name %]</dt>
    <dd>[% attribute.value %]</dd>

[%- END -%]

</dl>

<h2>User Roles</h2>
<p>List of users which have access to this reservation request.</p>
<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th>Name</th>
        <th>Role</th>
        <th>Email</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    [%- FOREACH userRole IN request.userRoles %]
    <tr>
        <td>[% userRole.user.firstName%] [% userRole.user.lastName%]</td>
        <td>
            [% IF userRole.role == 'OWNER' %]
            <span class="role-owner">Owner<div class="info-icon"></div></span>
            [% END %]
            [% IF userRole.role == 'RESERVATION_USER' %]
            <span class="role-reservationUser">User<div class="info-icon"></div></span>
            [% END %]
        </td>
        <td>[% userRole.user.emails.0 %]</td>
        <td>
            <a href="[% location %]/modify-user-role?id=[% userRole.id %]">modify</a>
            |
            <a href="[% location %]/delete-user-role?id=[% userRole.id %]">delete</a>
        </td>
    </tr>
    [%- END %]
    [%- IF !request.userRoles.size %]
    <tr><td colspan="4" class="empty">- - - None - - -</td></tr>
    [% END %]

    </tbody>
</table>
<div class="pull-right">
    <a class="btn" href="[% location %]/create-user-role?entity=[% request.id %]">Add User Role</a>
</div>&nbsp;

[% IF request.specification.class == 'RoomSpecification' -%]
[% INCLUDE common/detail_room.html %]
[% END -%]

[%- IF request.specification.class == 'AliasSpecification' || request.specification.class == 'AliasSetSpecification' -%]
[% INCLUDE common/detail_alias.html %]
[% END -%]

<div class="pull-right">
    <a class="btn btn-primary" href="[% back %]">Back</a>
    [%- IF request.specification.class == 'AliasSpecification' || request.specification.class == 'AliasSetSpecification' -%]
    [% IF request.reservationId && (request.stateCode == 'allocated' || request.stateCode == 'started') %]
    <a class="btn" href="[% location %]/create?alias=[% request.reservationId %]">Request Room Capacity</a>
    [% ELSE %]
    <span class="btn disabled">Request Room Capacity</span>
    [% END %]
    [% END %]
    <a class="btn" href="">Refresh</a>
    <a class="btn" href="[% location %]/delete?id=[% request.id %]">Delete</a>
</div>