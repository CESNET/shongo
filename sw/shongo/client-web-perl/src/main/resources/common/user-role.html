<style type="text/css">
    .roles-tooltip {
        position: absolute;
        display: none;
        margin-top: 5px;
        padding: 5px 10px;
        border: 1px solid #BBBBBB;
        border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px;
        background-color: #FFFFFF;
    }
</style>
<script type="text/javascript">
    window.formatUser = function(user) {
        var text = user.firstName;
        if ( user.lastName != null ) {
            text += " " + user.lastName;
        }
        text +=  " (id: " + user.userId + ")";
        if ( user.emails != null && user.emails.length > 0) {
            text += ", " + user.emails[0];
        }
        return text;
    };
    $(function() {
        $(".users").tooltip({ title: "[% resources.user.list %]"});
        $(".roles").bind({
            mouseover: function(){
                $(".roles-tooltip").fadeIn();
            },
            mouseleave: function(){
                $(".roles-tooltip").fadeOut();
            }
        });
        $("#selectUser").select2({
            placeholder: "Select user by name/email",
            width: 'resolve',
            minimumInputLength: 2,
            ajax: {
                url: "[% location %]/list-users",
                dataType: 'json',
                data: function (term, page) {
                    return {
                        filter: term
                    };
                },
                results: function (data, page) {
                    var results = [];
                    for ( var index = 0; index < data.length; index++ ) {
                        var dataItem = data[index];
                        results.push({id: dataItem.userId, text: window.formatUser(dataItem)});
                    }
                    return {results: results};
                }
            },
            initSelection : function (element, callback) {
                var id = $(element).val();
                callback({id: 0, text: 'Loading...'});
                $.ajax("[% location %]/get-user?id=" + id, {
                    dataType: "json"
                }).done(function(data) {
                    callback({id: id, text: window.formatUser(data)});
                });
            }
        });
    });
</script>

[% IF !id %]
    [% type = 'create' %]
    <h1>Create new user role</h1>
[% ELSE %]
    [% type = 'modify' %]
    <h1>Modify existing user role</h1>
[% END %]

<form class="form-horizontal" action="[% location %]/[% type %]-user-role?[% "alias=" _ get.alias _ "&" IF get.alias %]confirmed" method="POST">

<input name="id" type="hidden" value="[% id %]"/>

<div class="control-group">
    <label class="control-label">For [% entityTitle %]:</label>
    <div class="controls">
        <input name="entity" type="hidden" value="[% entity %]"/>
        <span class="uneditable-input" style="width: 300px;">[% entity %]</span>
        [% error.entity %]
    </div>
</div>

<div class="control-group">
    <label class="control-label" for="selectUser">User:</label>
    <div class="controls">
        <input id="selectUser" name="user" type="text" value="[% user %]"/>
        <div class="users info-icon"></div>
        [% error.user %]
    </div>
</div>

<div class="control-group">
    <label class="control-label" for="selectRole">Role:</label>
    <div class="controls">
        <select id="selectRole" name="role">
            <option value="OWNER" [% IF role == 'OWNER' %]selected[% END %]>Owner</option>
            <option value="RESERVATION_USER" [% IF role == 'RESERVATION_USER' %]selected[% END %]>User</option>
        </select>
        <div class="roles info-icon"></div>
        [% error.role %]
        <div style="display: inline-block;">
            <div class="roles-tooltip">
                <strong>Owner</strong><br>
                [% resources.security.role.owner %]<br>
                <strong>User</strong><br>
                [% resources.security.role.reservationUser %]
            </div>
        </div>
    </div>
</div>

<div class="control-group">
    <div class="controls">
        [% IF !id %]
        <input class="btn btn-primary" type="submit" value="Create"/>
        [% ELSE %]
        <input class="btn btn-primary" type="submit" value="Modify"/>
        [% END %]
        <a class="btn" href="[% back %]">Cancel</a>
    </div>
</div>

</form>