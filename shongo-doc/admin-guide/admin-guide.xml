<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://docbook.org/xml/5.0/dtd/docbook.dtd">

<book>

<title>Shongo Administrator Guide</title>
<info>
    <title>Shongo Administrator Guide</title>
    <author>
        <firstname>Martin</firstname>
        <surname>Šrom</surname>
    </author>
    <author>
        <firstname>Ondřej</firstname>
        <surname>Pavelka</surname>
    </author>
</info>



<chapter>
<title>Modules</title>
<para>

Shongo consists of the following applications (modules):
<itemizedlist>
<listitem id="shongo-controller">
<para><emphasis role="bold">Controller</emphasis></para>
<para>
    Controller (<code>shongo-controller</code>) is main backend application in Shongo.
    In each domain you must run exactly one Controller.
    Controller uses Java to run and PostgreSQL to store data.
</para>
</listitem>
<listitem id="shongo-connector">
<para><emphasis role="bold">Connector</emphasis></para>
<para>
    Connector (<code>shongo-connector</code>) is application to control one or several devices
    (e.g., Cisco MCU or Adobe Connect server).
    In each domain you can run several Connectors and each of them can control several devices.
</para>
<para>
    Connector uses Java to run and JADE middleware to communicate with Controller.
</para>
</listitem>
<listitem id="shongo-client-web">
<para><emphasis role="bold">Web Client</emphasis></para>
<para>
    Web Client (<code>shongo-client-web</code>) is a web application which can be used by users to use Shongo.
</para>
<para>
    Web Client uses Java to run and XML-RPC to communicate with Controller.
    Web Client can run under Apache proxy.
</para>
</listitem>
<listitem  id="shongo-client-cli">
<para><emphasis role="bold">Command-Line Client</emphasis></para>
<para>
    Command-Line Client (<code>shongo-client-cli</code>) is a console application which can be used
    by administrators to manage Controller.
</para>
<para>
    Command-Line Client uses Perl to run and XML-RPC to communicate with Controller.
</para>
</listitem>
</itemizedlist>

</para>
</chapter>



<chapter>
<title>Installation</title>

<section>
<title>Prerequisites</title>
<para>
    Before installing Shongo you must first install the following software on target system:
    <itemizedlist>
        <listitem>
            <para><emphasis role="bold">Git</emphasis></para>
            <para>
                Git is required to download Shongo source code.
            </para>
            <para>
                How to install <code>git</code> on Debian:
                <screen>apt-get install git</screen>
                Check that <code>git</code> is installed:
                <screen>git --version</screen>
            </para>
        </listitem>
        <listitem>
            <para><emphasis role="bold">Java JDK 1.6 (Oracle)</emphasis></para>
            <para>
                Oracle Java Development Kit is required to build all Shongo applications and
                Oracle Java Runtime Environment (which is included in JDK) is required to run most of the Shongo applications
                (<link linkend="shongo-controller">Controller</link>, <link linkend="shongo-connector">Connector</link> and
                <link linkend="shongo-client-web">Client Web</link>).
            </para>
            <para>
                How to install <code>java</code> on Debian:
                <screen>
echo "deb http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main" | \
        tee /etc/apt/sources.list.d/webupd8team-java.list
echo "deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main" | \
        tee -a /etc/apt/sources.list.d/webupd8team-java.list
apt-key adv --keyserver keyserver.ubuntu.com --recv-keys EEA14886
apt-get update
apt-get install oracle-java6-installer
                </screen>
                Check that <code>java</code> is installed:
                <screen>java -version</screen>
            </para>
        </listitem>
        <listitem>
            <para><emphasis role="bold">Maven 2.2.1</emphasis></para>
            <para>
                Maven is required to build all Shongo applications (<link linkend="shongo-controller">Controller</link>,
                <link linkend="shongo-connector">Connector</link>, <link linkend="shongo-client-web">Client Web</link>
                and <link linkend="shongo-client-cli">Command-Line Client</link>).
            </para>
            <para>
                How to install <code>mvn</code> on Debian:
                <screen>apt-get install maven2</screen>
                Check that <code>mvn</code> is installed:
                <screen>mvn --version</screen>
            </para>
        </listitem>
        <listitem>
            <para><emphasis role="bold">PostgreSQL</emphasis></para>
            <para>
                PostgreSQL is required only if you want to install <link linkend="shongo-controller">Controller</link>.
                Other Shongo applications don't require it.
            </para>
            <para>
                How to install <code>postgresql</code> on Debian:
                <screen>apt-get install postgresql</screen>
                Check that <code>psql</code> is installed:
                <screen>psql --version</screen>
            </para>
        </listitem>
        <listitem>
            <para><emphasis role="bold">Perl</emphasis></para>
            <para>
                Perl is required only if you want to run <link linkend="shongo-client-cli">Command-Line Client</link>.
                Other Shongo applications don't require it.
            </para>
            <para>
                How to install <code>perl</code> on Debian:
                <screen>apt-get install perl</screen>
                Check that <code>perl</code> is installed:
                <screen>perl --version</screen>
            </para>
        </listitem>
    </itemizedlist>
</para>
</section>

<section>
<title>Build</title>
<para>
    To build Shongo you must first download it's source code.
</para>
<para>
    Clone the Git repository with the Shongo source code to location
    where you want to have the Shongo installed (e.g., <code>/app/shongo</code>).
    You can clone the source code from the development repository (if you have access to it):
    <screen>git clone &lt;user&gt;@homeproj.cesnet.cz:shongo /app/shongo</screen>
    Or you can clone it from the GitHub:
    <screen>git clone https://github.com/shongo/shongo.git /app/shongo</screen>

    Then go to location with the Shongo source code, checkout version of Shongo which you want to build and build it by Maven.
    <screen>
cd /app/shongo
git checkout v0.8.0
mvn package
    </screen>

    To list available versions of Shongo use the following command:
    <screen>git tag</screen>
    It will output the versions in the following format:
    <screen>
v0.5.0
v0.5.1
v0.5.2
v0.6.0
v0.7.0
    </screen>

    Maven builds all Java applications (<link linkend="shongo-controller">Controller</link>,
    <link linkend="shongo-connector">Connector</link> and <link linkend="shongo-client-web">Client Web</link>)
    and prepares the Perl application for usage (<link linkend="shongo-client-cli">Command-Line Client</link>).

</para>
<para>
    If you want to install Shongo for domain which already have some Shongo extensions
    (e.g., custom design for Web Client), you should clone also the Git repository with the extension.
    For example for CESNET domain you should clone the following repository from GitHub:
    <screen>
git clone https://github.com/shongo/shongo-domain-cesnet.git \
        /app/shongo/shongo-domain/cesnet
    </screen>
    The domain extension should be placed to folder <code>&lt;shongo&gt;/shongo-domain/&lt;domain-name&gt;</code>,
    where <code>&lt;shongo&gt;</code> is the location where you cloned the Shongo source code (e.g., <code>/app/shongo</code>)
    and the <code>&lt;domain-name&gt;</code> is the name of the domain for which you want to store the extension (e.g., <code>cesnet</code>).
</para>
</section>

<section>
<title>Install services</title>
<para>
    Once the Shongo is built you can install one or more Shongo applications into your system. You can install only
    <link linkend="shongo-controller">Controller</link>, <link linkend="shongo-connector">Connector</link> and
    <link linkend="shongo-client-web">Client Web</link> into your system as service. The <link linkend="shongo-client-cli">Command-Line Client</link>
    application must be used from the installed location (e.g., <code>/app/shongo/shongo-deployment/bin/shongo-client-cli.sh</code>).
</para>
<para>
    All following paths are relative to root folder where you cloned and built the Shongo source code
    (e.g., <code>/app/shongo</code>).
</para>
<para>
    Services can be installed by running the following command <emphasis role="bold">as superuser</emphasis>:
    <screen>shongo-deployment/service/shongo-install.sh &lt;applications&gt;</screen>
    The command takes one argument <code>&lt;applications&gt;</code> which is the list of Shongo application names
    separated by spaces which should be installed or it can be leaved empty to install all applications.
</para>
<para>
    <emphasis role="bold">Examples:</emphasis>
    <screen>
# Become superuser
su root

# Install Controller and Client-Web applications
shongo-deployment/service/shongo-install.sh shongo-controller shongo-client-web

# Install only Connector application
shongo-deployment/service/shongo-install.sh shongo-connector

# Install all Shongo applications (Controller, Connector and Client Web)
shongo-deployment/service/shongo-install.sh
    </screen>
</para>
<para>
    Services can be uninstalled by running the following command <emphasis role="bold">as superuser</emphasis>:
    <screen>
# Become superuser
su root

# Uninstall all installed Shongo applications
shongo-deployment/service/shongo-uninstall.sh
    </screen>
</para>
</section>

</chapter>



<chapter>
<title>Configuration</title>

Each Shongo application can be configured by a XML configuration file. When a configuration file is modified the application
must be restarted to reload the changes. The configuration files must be located inside
<code>&lt;shongo&gt;/shongo-deployment/</code> directory, where <code>&lt;shongo&gt;</code> is the location where you installed
the Shongo (e.g., <code>/app/shongo</code>).



<section>
<title>Controller</title>
<para>
    To configure Controller create configuration file <code>shongo-controller.cfg.xml</code>.
</para>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
    ...
</configuration>
]]></screen>
</para>
<para>It can contain the following options:</para>
<itemizedlist>

<listitem>
<para><emphasis role="bold">Domain settings</emphasis></para>
<variablelist>
    <varlistentry>
        <term><code>domain/name</code></term>
        <listitem><para>
            Specifies unique name of the domain. It will be used in all object identifiers
            (e.g., domain name <code>meetings.cesnet.cz</code> will used in identifier of a reservation request <code>shongo:meetings.cesnet.cz:req:1</code>).
        </para></listitem>
    </varlistentry>
    <varlistentry>
        <term><code>domain/code</code></term>
        <listitem><para>
            Specifies shortcut of domain name and it doesn't have to be unique across domains.
            It will be used as prefix in email notifications (e.g., domain code <code>meetings</code> in email subject <code>[meetings] Notification ...</code>)
        </para></listitem>
    </varlistentry>
    <varlistentry>
        <term><code>domain/organization</code></term>
        <listitem><para>
            Specifies name of the organization who owns the domain.
        </para></listitem>
    </varlistentry>
</variablelist>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<domain>
    <name>meetings.cesnet.cz</name>
    <code>meetings</code>
    <organization>CESNET, z.s.p.o.</organization>
</domain>
        ]]></screen>
</para>
</listitem>

<listitem>
<para><emphasis role="bold">Database settings</emphasis></para>
<variablelist>
    <varlistentry>
        <term><code>database/driver</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
    <varlistentry>
        <term><code>database/url</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
    <varlistentry>
        <term><code>database/username</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
    <varlistentry>
        <term><code>database/password</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
</variablelist>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<database>
    <driver>org.postgresql.Driver</driver>
    <url>jdbc:postgresql://127.0.0.1/shongo</url>
    <username>shongo</username>
    <password>(password)</password>
</database>
]]></screen>
</para>
</listitem>

<listitem>
<para><emphasis role="bold">Security settings</emphasis></para>
<variablelist>
    <varlistentry>
        <term><code>security/server</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
    <varlistentry>
        <term><code>security/client-id</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
    <varlistentry>
        <term><code>security/client-secret</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
</variablelist>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<security>
    <server>https://shongo-auth.cesnet.cz</server>
    <client-id>meetings.cesnet.cz</client-id>
    <client-secret>(secret)</client-secret>
</security>
]]></screen>
</para>
</listitem>

<listitem>
<para><emphasis role="bold">SMTP settings</emphasis></para>
<variablelist>
    <varlistentry>
        <term><code>smtp/sender</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
</variablelist>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<smtp>
    <sender>shongo@gmail.com</sender>
    <host>smtp.gmail.com</host>
    <port>465</port>
    <username>shongo@gmail.com</username>
    <password>(password)</password>
</smtp>
]]></screen>
</para>
</listitem>

<listitem>
<para><emphasis role="bold">Administrator settings</emphasis></para>
<variablelist>
    <varlistentry>
        <term><code>administrator</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
</variablelist>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<administrator>martin.srom@cesnet.cz</administrator>
<administrator>pavelka@cesnet.cz</administrator>
]]></screen>
</para>
</listitem>

<listitem>
<para><emphasis role="bold">Email notification settings</emphasis></para>
<variablelist>
    <varlistentry>
        <term><code>notification.reservation-request-url</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
    <varlistentry>
        <term><code>notification.user-settings-url</code></term>
        <listitem><para>
            ...
        </para></listitem>
    </varlistentry>
</variablelist>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<notification>
    <reservation-request-url>
        https://meetings.cesnet.cz/detail/${reservationRequestId}
    </reservation-request-url>
    <user-settings-url>
        https://meetings.cesnet.cz/user/settings
    </user-settings-url>
</notification>
]]></screen>
</para>
</listitem>

</itemizedlist>
</section>



<section>
<title>Connector</title>
<para>
    To configure Connector create configuration file <code>shongo-connector.cfg.xml</code>.
</para>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
    ...
</configuration>
]]></screen>
</para>
<para>It can contain the following options:</para>
<itemizedlist>

<listitem>TODO:</listitem>

</itemizedlist>
</section>



<section>
<title>Web Client</title>
<para>
    To configure Web Client create configuration file <code>shongo-client-web.cfg.xml</code>.
</para>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
    ...
</configuration>
]]></screen>
</para>
<para>It can contain the following options:</para>
<itemizedlist>

<listitem>TODO:</listitem>

</itemizedlist>
</section>



<section>
<title>Command-Line Client</title>
<para>
    To configure Command-Line Client create configuration file <code>shongo-client-cli.cfg.xml</code>.
</para>
<para>
    <emphasis role="bold">Example:</emphasis>
    <screen><![CDATA[
<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
    ...
</configuration>
]]></screen>
</para>
<para>It can contain the following options:</para>
<itemizedlist>

<listitem>TODO:</listitem>

</itemizedlist>
</section>



</chapter>



<chapter>
<title>Management</title>

<section>
<title>Services</title>
<para>
    The applications <link linkend="shongo-controller">Controller</link>, <link linkend="shongo-connector">Connector</link> and
    <link linkend="shongo-client-web">Client Web</link> are installed as services.
</para>
<para>
    To start/stop/restart all installed services use:
    <screen>service shongo [start|stop|restart]</screen>

    To start/stop/restart single service use:
    <screen>
service shongo-controller [start|stop|restart]
service shongo-connector [start|stop|restart]
service shongo-client-web [start|stop|restart]
    </screen>

    To show status of all installed services use:
    <screen>service shongo status</screen>

    To show status of single services use:
    <screen>service [shongo-controller|shongo-connector|shongo-client-web] status</screen>
</para>
</section>

<section>
<title>Logs</title>
<para>
    Log files from application services can be found in <code>/var/log/shongo/</code> directory. The directory contains
    a file for each startup of each service.
</para>
<para>
    If you have started a <code>shongo-controller</code> service at 12:30 on 2014-01-01 you can find it's log file here:
    <screen>/var/log/shongo/shongo-controller_2014-01-01T12:30.log</screen>
</para>
</section>

<section>
<title>Command-Line Client</title>
<para>
    TODO: how to start shongo-client-cli
</para>
<para>
    TODO: how to use shongo-client-cli
</para>
</section>
</chapter>



</book> 

