\documentclass[a4paper]{report}
\usepackage{geometry}
\geometry{paper=a4paper}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenx}
\usepackage{palatino}
\usepackage{mathpazo}
\usepackage{microtype}
\renewcommand*\ttdefault{txtt}

\usepackage[czech,english]{babel}

\usepackage[pdftex,breaklinks=true,pdfborder={0 0 0}]{hyperref}
\usepackage[pdftex]{graphicx}
\usepackage{paralist} 
\usepackage{multicol}
\usepackage{verbatim}
\usepackage{listings}

\usepackage{tikz}
\usetikzlibrary{arrows, shapes, calc, decorations}
\usepackage{amsmath}
\usepackage[numbers]{natbib}

\usepackage{xcolor}
\newcommand{\TODO}[1]{%
\def\empty{}%
\def\prvniparametr{#1}%
\ifx\prvniparametr\empty%
\begingroup\tt\textcolor{red}{\noindent\textbf{TODO}}\endgroup
\else%
\begingroup\tt\textcolor{red}{\noindent\textbf{TODO:}\ #1}\endgroup
\fi%
}

\input{graph.tex}


\begin{document}


\title{Scheduler for Shongo}
\author{Petr Holub, Jan Růžička, Miloš Liška, Martin Šrom, Ondřej Pavelka, Ondřej Bouda}
\date{\copyright~CESNET~z.\,s.\,p.\,o.\\2012}
\maketitle
\tableofcontents


\chapter{Technology}

This chapter describes widely-used videoconference technologies. Types of network elements and network examples are listed for each technology.


\section{H.323}

The H.323 network is composed of terminals, multipoint control units, gateways and gatekeepers. Terminals, MCUs and gateways are referred to as endpoints. At least two terminals are needed to start a videoconference call.

\subsection{Elements}

\begin{itemize}

\item \textbf{Terminal} \\
Terminal represents a hardware device or a software client that enables a single person or a group of persons situated in front of the device to connect to another H.323 endpoint and take a videoconference call.

There are special terminal devices that provides a single virtual room to which can connect multiple other endpoints.  These terminals thus allow to make a multipoint videoconference even without the MCU.

There are also special terminal devices that only receives videoconference channels and are used to stream or record them. They are referred to as streaming or recording servers.

\item \textbf{Multipoint Control Unit} (MCU) \\
MCU represents a hardware device that is used for hosting of videoconference calls in which can generally participate any number of endpoints. MCU contains one or more \textbf{virtual rooms} and each virtual room can host one videoconference call at the time. MCU can restrict the number of participants per virtual room or per whole MCU device.

\item \textbf{Gateway} \\
Gateway is device that enable communication between H.323 network and other networks (e.g., PSTN).

\item \textbf{Gatekeeper} \\
Gatekeeper is a hardware device that provides special services to the other elements in the network: endpoint registration, address resolution, admission control and user authentication. It can limit the number of connections that are established through it.

\end{itemize}

Each H.323 element is running on a specific IP address that can be used to connect to the element. An element can have assigned alias, \textbf{H.323 phone number} (defined by E.164) or \textbf{H.323 identifier} (string, e.g., email), that can be used to connect to it. Alias is useful when the IP address is not known (e.g., the device is behind the NAT) or it is likely to change (organization changes).

Alias can be assigned only to \textbf{terminal} or \textbf{virtual room} in MCU. When a terminal has assigned alias it must register to one \textbf{gatekeeper} that will be able to translate the alias to the terminal IP address. When an element want to connect to another terminal or virtual room by alias, it must use the same gatekeeper that has the proper registry of aliases or the gatekeeper must be configured to route the request to a proper other gatekeeper.

When a gatekeeper is used in videoconference, it can work in two modes:
\begin{itemize}
\item Direct Endpoint Model -- The gatekeeper is used only for initialization (address resolution, admission control, etc.) and the videoconference call itself is managed by it's participants (endpoints). The gatekeeper doesn't have full control over the call signaling. The target IP address is communicated to the caller.
\item Gatekeeper Routed Model -- The gatekeeper is used throughout videoconference call, the call signaling flow through the gatekeeper and it has the full control over it. The target IP address is not communicated to the caller.
\end{itemize}

Each terminal and MCU element can have set zero or one gatekeeper. If gatekeeper is set then each terminal and virtual room in MCU can have an alias set. Each terminal and MCU element should also be configured to allow or forbid the direct connections through IP address. When the gatekeeper with admission control is set, it is appropriate to forbid direct connections through IP address.

\subsection{Constraints}

\begin{itemize}
\item Communication consists of:
\begin{compactenum}
\item Audio
\item Audio + Video
\item Audio + Data
\item Audio + Video + Data
\end{compactenum}
\TODO{Do we want to know in Topology which of 4 modes each device support?}

\item Bidirectional accessibility. When an element $A$ is accessible to an element $B$ then also $B$ is accessible to $A$.
\end{itemize}

\subsection{Network Examples}

% H.323 Graph Declarations
\tikzstyle{hxxxData}=[color=red]
\tikzstyle{hxxxDataDashed}=[color=red, dashed]
\tikzstyle{hxxxControl}=[color=orange]
\tikzstyle{hxxxAlias}=[color=blue, dashed]
\tikzstyle{hxxxIp}=[color=green, dashed]
\newcommand{\HXXXLegend}[1]{
  \begin{GraphLegend}{#1}
    \GraphLegendItem{hxxxData}{Call data flow}
    \GraphLegendItem{hxxxControl}{Call control flow}
    \GraphLegendItem{hxxxAlias}{Connect by H.323 alias}
    \GraphLegendItem{hxxxIp}{Connect by IP address}
  \end{GraphLegend}
}

\subsubsection{Connection through direct IP addresses}

Terminals and virtual rooms in MCU don't have assigned any H.323 aliases thus the connecting is done through IP addresses. This topology allows for 2-point videoconferences (e.g., \emph{terminal1 -- terminal2}) and multipoint videoconferences through the MCU (e.g., \emph{terminal1 -- terminal2 -- terminal3 -- mcu}). When a terminal connects to the MCU it must select the proper virtual room, because the IP address determines only the MCU not a specific virtual room.

\begin{Graph}{graph:h323:direct}{Connection through direct IP addresses}
  \Vertex{0, 0}{t1}{terminal1}
  \Vertex{4, 0}{t2}{terminal2}
  \Vertex{4,-4}{t3}{terminal3}
  \Vertex{0,-4}{mcu}{mcu}
  
  \EdgeAllToAll{<->}{hxxxIp, hxxxData, hxxxControl}{t1, t2, t3, mcu}
  
  \HXXXLegend{6, -1.5}
\end{Graph}

\subsubsection{Connection through a gatekeeper (Direct Endpoint Model)}

Terminals and MCUs are configured to forbid direct connections through IP addresses. Terminals and MCU virtual rooms have assigned H.323 aliases and the devices register to the gatekeeper that is able to resolve these aliases to direct IP addresses. When a terminal want to start videoconference he must request the gatekeeper. The request must contain H.323 alias of another terminal or virtual room in MCU to which the terminal wants to connect. The gatekeeper resolves an IP address from the alias and return it to the caller which then is able to start videoconference data flow to the requested target. The gatekeeper can perform admission control and forbid the connection. When a videoconference ends the caller informs the gatekeeper again. The gatekeeper holds the list of active connections and thus can limit the maximum number of connections at the same time.

\begin{Graph}{graph:h323:gatekeeper}{Connection through gatekeeper}
  \Vertex{ 0, 0}{t1}{terminal1}
  \Vertex{ 4, 0}{t2}{terminal2}
  \Vertex{ 4,-4}{t3}{terminal3}
  \Vertex{ 0,-4}{mcu}{mcu}
  \Vertex{-2,-2}{gk}{gatekeeper}
  
  \EdgeAllToAll{<->}{hxxxData, hxxxControl}{t1, t2, t3, mcu}
  \EdgeOneToAll{<->}{hxxxAlias}{gk}{t1, t2, t3, mcu}
  
  \HXXXLegend{6, -1.5}
\end{Graph}

\subsubsection{Connection through a gatekeeper (Gatekeeper Routed Model)}

Terminals and MCUs are configured to forbid direct connections through IP addresses. Terminals and MCU virtual rooms have assigned H.323 aliases and the devices register to the gatekeeper that is able to resolve these aliases to direct IP addresses. When a terminal want to start videoconference he must request the gatekeeper. The request must contain H.323 alias of another terminal or virtual room in MCU to which the terminal wants to connect. The gatekeeper resolves an IP address from the alias and establish connection to the target endpoint. The call is then mediated by the gatekeeper throughout the videoconference. The gatekeeper can also perform admission control and limit the number of active connections. In special cases even the data flow can be routed through the gatekeeper (e.g., when connecting endpoints behind the NAT).

\begin{Graph}{graph:h323:gatekeeperRouted}{Connection through gatekeeper}
  \Vertex{0, 0}{t1}{terminal1}
  \Vertex{4, 0}{t2}{terminal2}
  \Vertex{4,-4}{t3}{terminal3}
  \Vertex{0,-4}{mcu}{mcu}
  \Vertex{-2,-2}{gk}{gatekeeper}
  
  \EdgeAllToAll{<->}{hxxxData}{t1, t2, t3, mcu}  
  \EdgeOneToAll{<->}{hxxxAlias, hxxxControl}{gk}{t1, t2, t3, mcu}
  
  \HXXXLegend{6, -1.5}
\end{Graph}

\subsubsection{Multiple gatekeepers}

The network is composed from 3 endpoints (\emph{terminal1, terminal2, mcu}) managed by \emph{gatekeeper1} and 2 subdomains where each is composed of 2 endpoints and one gatekeeper.%
\begin{Graph}{graph:h323:gatekeeperMultiple}{Multiple gatekeepers}
  \Vertex{ 0, 0}{gk1}{gatekeeper1}
  \Vertex{-2,-2}{gk2}{gatekeeper2}
  \Vertex{ 2,-2}{gk3}{gatekeeper3}
  \EdgeAllToAll{<->}{hxxxAlias, hxxxControl}{gk1, gk2, gk3}
  
  \Vertex{-2, 2}{t1}{terminal1}
  \Vertex{ 2, 2}{t2}{terminal2}
  \Vertex{ 0, 4}{mcu}{mcu}
  \EdgeAllToAll{<->}{hxxxIp, hxxxControl, hxxxData}{t1, t2, mcu}  
  \EdgeOneToAll{<->}{hxxxAlias, hxxxControl}{gk1}{t1, t2, mcu}  

  \Vertex{-5,-1}{t3}{terminal3}
  \Vertex{-5,-3}{t4}{terminal4}
  \Edge{<->}{hxxxIp, hxxxControl, hxxxData}{t3}{t4}
  \EdgeOneToAll{<->}{hxxxAlias, hxxxControl}{gk2}{t3, t4}  
     
  \Vertex{5,-1}{t5}{terminal5}
  \Vertex{5,-3}{t6}{terminal6}
  \Edge{<->}{hxxxIp, hxxxControl, hxxxData}{t5}{t6}
  \EdgeOneToAll{<->}{hxxxAlias, hxxxControl}{gk3}{t5, t6}    
  
  \Edge{<-}{hxxxDataDashed}{mcu}{$(mcu) + (0,1)$}
  \Edge{<-}{hxxxDataDashed}{t1}{$(t1) + (-1.5,0)$}
  \Edge{<-}{hxxxDataDashed}{t2}{$(t2) + (1.5,0)$}
  \Edge{<-}{hxxxDataDashed}{t3}{$(t3) + (0.3, 1)$}
  \Edge{<-}{hxxxDataDashed}{t4}{$(t4) + (0.8,-1)$}
  \Edge{<-}{hxxxDataDashed}{t5}{$(t5) + (-0.3, 1)$}
  \Edge{<-}{hxxxDataDashed}{t6}{$(t6) + (-0.8,-1)$}

  \HXXXLegend{4.5, 4}
\end{Graph}%
Adjacent endpoints (endpoints in the same local network) can connect directly or through it's gatekeeper. Not adjacent endpoints (endpoints from different local networks) can connect only by it's gatekeepers.

\subsection{Suggested Topology}
In Topology should be present only endpoints (terminals, MCUs, gateways). The gatekeepers will be kept aside and will be used only to determine which devices are accessible by which devices and to limit the number of active connections that will flow through them (if maximum number of connections is specified for the gatekeeper). See fig. \ref{graph:h323:topology}.

\begin{Graph}{graph:h323:topology}{Suggested topology for H.323}  
  \Vertex{-2, 4}{gk1}{gatekeeper1}
  \Vertex{-2, 2}{t1}{terminal1}
  \Vertex{-2,-2}{t2}{terminal2}
  \Vertex{-4, 0}{mcu}{mcu}

  \Vertex{2, 4}{gk2}{gatekeeper2}  
  \Vertex{2, 2}{t3}{terminal3}
  \Vertex{2,-2}{t4}{terminal4}
  
  \node at (-2, 3) {\textit{H.323 subdomain 1}};
  \node at ( 2, 3) {\textit{H.323 subdomain 2}};
  \draw[dashed, color=gray](0,4.6) -- (0,-2.5);
    
  \EdgeAllToAll{<->}{hxxxAlias, hxxxIp}{t1, t2, mcu}  
  \EdgeAllToAll{<->}{hxxxAlias, hxxxIp}{t3, t4}  
  \EdgeOneToAll{<->}{hxxxAlias}{t3}{t1, t2, mcu}  
  \EdgeOneToAll{<->}{hxxxAlias}{t4}{t1, t2, mcu}  
  
  \begin{GraphLegend}{4, 0.5}
    \GraphLegendItem{hxxxAlias}{Accessible by H.323 alias}
    \GraphLegendItem{hxxxIp}{Accessible by IP in H.323}
  \end{GraphLegend}
\end{Graph}

\paragraph{Notes:}
\begin{itemize}
\item At the global level there should be a list of rules that defines which devices are accessible to which devices by IP address (similarly to firewall definition). By default all H.323 endpoints are accessible to all by IP address (even with different assigned gatekeepers).
\item At the global level there should be a list of rules that defines which devices are accessible to which devices by alias. Rules should primarily use gatekeepers for specifying accessibility (e.g., endpoints from the first gatekeeper are accessible to endpoints from the second gatekeeper). By default endpoints are accessible only inside the same gatekeeper. The accessibility between two gatekeepers must be explicitly defined by a rule.
\end{itemize}

\subsection{References}

\renewcommand{\bibsection}{}
\begin{thebibliography}{1}
\bibitem[1]{bib:h323:wiki}
H.323 on Wikipedia.
\\\url{https://en.wikipedia.org/wiki/H.323}

\bibitem[2]{bib:h323:architecture}
Basic Architecture of H.323.
\\\url{http://hive1.hive.packetizer.com/users/packetizer/papers/h323/h323_basics_handout.pdf}

\bibitem[3]{bib:h323:gatekeepers}
Understanding H.323 Gatekeepers.
\\\url{http://www.cisco.com/en/US/tech/tk1077/technologies_tech_note09186a00800c5e0d.shtml}
\end{thebibliography}


\section{SIP}

The Session Initiation Protocol (SIP) is a signaling protocol for establishing calls and videoconferences over IP networks.

\subsection{Elements}

Type of elements in SIP network:

\begin{itemize}
\item \textbf{User Agent} \\
User agent is a hardware or software client that allows user to take a 
videoconference call. It can create and receive SIP messages and thereby
manage a SIP session.

Each user agent should have set precisely one registrar to which it registers and it will be available through it to other agents.

\item \textbf{Multipoint Control Unit} (MCU) \\
MCU represents the same hardware device as in H.323. It contains one or more \textbf{virtual rooms} and each virtual room can host one videoconference call at the time.

A single MCU device can support both SIP and H.323 technology which means that to a single virtual room on that MCU can connect SIP user agents and also H.323 terminals. Each virtual room can be configured to support both technologies or only one of these technologies.

\item \textbf{Proxy Server} \\
Proxy server is an intermediary entity whose main role is to route requests to another entity that is closer to the target. Proxy server can also perform admission control.

\item \textbf{Redirect Server} \\
Redirect server response to each client request by alternative set of URIs which should client contact instead of the original target.

\item \textbf{Registrar} \\
Registrar is an element that keeps register of user agents. Each user agent can register itself to a registrar for a specific URI. More user agents can be registered to a single URI. 

\item \textbf{Gateway} \\
Gateway is a device that enable communication between SIP network and other networks (e.g., PSTN).
\end{itemize}

Each user agent in a SIP network is identified by an uniform resource identifier (URI), for instance \verb|sip:username:password@host:port|. Multiple user agents can register to registrar with a single URI and when the URI is requested by a caller all devices will "ring" and only one can answer the call (e.g., one user with single URI can have multiple phones, hardware or software, by which he can answer an incoming calls).

The URI can contain the target IP address. When an user agent use this type of URI to start a call, user agent's Gatekeeper (Registrar, Proxy or Redirect Server) is still used to initiate the call unlike in H.323 where the connection can be done directly through the IP address without notifying a Gatekeeper.

Single element in SIP network can be a combination of multiple SIP element types (e.g., \emph{Proxy and Registrar Server} or \emph{Redirect and Registrar Server}).

\subsection{Constraints}

\begin{itemize}

\item Communication consists of:
\begin{compactenum}
\item Audio
\item Audio + Video
\item Audio + Video + Data
\end{compactenum}

\item Bidirectional accessibility. When an element $A$ is accessible to an element $B$ then also $B$ is accessible to $A$.

\item Each user agent must have the the Registrar set.

\end{itemize}

\subsection{Network Examples}

SIP network is very similar to H.323 network and doesn't bring any new aspects or elements thus this section can be skipped.

\subsection{Suggested topology}

For SIP network we will use the same naming convention as for H.323 and endpoints will stand for user agents (terminals), MCUs and gateways. Proxy server, Redirect server and Registrar will be grouped into a single element Gatekeeper.%
\tikzstyle{sipUri}=[color=red, dashed]
\begin{Graph}{graph:sip:topology}{Suggested topology for SIP}  
  \Vertex{-2, 4}{gk1}{gatekeeper1}
  \Vertex{-2, 2}{a1}{userAgent1}
  \Vertex{-2,-2}{a2}{userAgent2}
  \Vertex{-4, 0}{mcu}{mcu}

  \Vertex{2, 4}{gk2}{gatekeeper2}  
  \Vertex{2, 2}{a3}{userAgent3}
  \Vertex{2,-2}{a4}{userAgent4}
  
  \node at (-2, 3) {\textit{SIP subdomain 1}};
  \node at ( 2, 3) {\textit{SIP subdomain 2}};
  \draw[dashed, color=gray](0,4.6) -- (0,-2.5);
    
  \EdgeAllToAll{<->}{sipUri}{a1, a2, mcu, a3, a4}  
  
  \begin{GraphLegend}{4, 0.0}
    \GraphLegendItem{sipUri}{Accessible by SIP URI}
  \end{GraphLegend}
\end{Graph}
In Topology should be present only endpoints. Gatekeeper elements are kept aside and they are used only when the topology is constructed to determine which endpoints are accessible from which endpoints. See fig. \ref{graph:sip:topology}.

\paragraph{Notes:}
\begin{itemize}
\item Similarly like in H.323, at the global level there should be a list of rules that defines which devices are accessible to which devices by URI. By default endpoints are accessible only inside the same gatekeeper. The accessibility between two gatekeepers must be explicitly defined by a rule.
\end{itemize}

\subsection{References}

\renewcommand{\bibsection}{}
\begin{thebibliography}{1}

\bibitem[1]{bib:sip:architecture}
Session Initiation Protocol (SIP)
\\ \url{http://www.vide.net/cookbook/cookbook.en/list_page.php?topic=3&url=sip.htm}

\bibitem[2]{bib:sip:wiki}
Session Initiation Protocol on Wikipedia.
\\ \url{https://en.wikipedia.org/wiki/Session_Initiation_Protocol}

\end{thebibliography}


\section{Adobe Connect}

Adobe Connect is a web conferencing software for web meetings, eLearning, and webinars. The software is running as a server on a specific URL. It contains several meetings (virtual rooms) which can be accessed by clients.

\subsection{Elements}

Type of elements in Adobe Connect network:

\begin{itemize}
\item \textbf{Client} \\
Client for Adobe Connect is a web browser with Adobe Flash Player installed or Adobe Connect Add-in. To be able to connect two clients, the Adobe Connect server with created meeting is needed as opposed to H.323/SIP  where two terminals/user agents are sufficient to start a videoconference.

Special type of client \textbf{Gateway} can exist. This client can translate Adobe Connect videoconference to other technology (e.g., SIP or H.323).

\item \textbf{Server} \\
Server is an installed Adobe Connect software that is made accessible on a specific URL. On the server one or multiple meetings (virtual rooms) can be created. Clients are then able to connect to a meeting on a server. Each virtual room can be accessed by the server URL followed by a meeting name (e.g., \verb|obelix.cesnet.cz/<MEETING_NAME>|).
\end{itemize}

Adobe Connect servers cannot be cascaded (connected together) as opposed to H.323/SIP MCUs which can be cascaded. Thus the Adobe Connect videoconference scheduling will be simpler task than scheduling for other described technologies.

Clients can be identified by shibboleth (e.g., eduID.cz). Managed client doesn't make sense, it would be controlling application for a web browser. Managed client only make sense for gateway client (e.g, client that translate Adobe Connect channels to SIP or H.323).

\subsection{Constraints}

\begin{itemize}
\item Communication consists of:
\begin{compactenum}
\item Audio
\item Audio + Video
\item Audio + Video + Data
\end{compactenum}
\end{itemize}

\subsection{Suggested topology}

In Topology should be present both clients and servers. Edges will be only between clients and servers and not between clients themselves. When two clients want to take a videoconference call they both must connect to the same Adobe Connect meeting on the same server.

% SIP Graph Declarations
\tikzstyle{connectUrl}=[color=violet, dashed]

\begin{Graph}{graph:connect:topology}{Suggested topology for Adobe Connect}  
  \Vertex{-2, 3}{s1}{server1}
  \Vertex{-3, 0}{c1}{client1}
  \Vertex{-1, 0}{c2}{client2}

  \Vertex{2, 3}{s2}{server2}  
  \Vertex{1, 0}{c3}{client3}
  \Vertex{3, 0}{c4}{client4}
      
  \EdgeOneToAll{<-}{connectUrl}{s1}{c1, c2, c3, c4}  
  \EdgeOneToAll{<-}{connectUrl}{s2}{c1, c2, c3, c4}  
  
  \begin{GraphLegend}{4.5, 1.5}
    \GraphLegendItem{connectUrl}{Accessible by Adobe Connect URL}
  \end{GraphLegend}
\end{Graph}

\subsection{References}

\renewcommand{\bibsection}{}
\begin{thebibliography}{1}

\bibitem[1]{bib:connect:architecture}
Adobe Connect Official Website.
\\ \url{http://www.adobe.com/products/adobeconnect.html}

\bibitem[2]{bib:connect:wiki}
Adobe Connect on Wikipedia.
\\ \url{http://en.wikipedia.org/wiki/Adobe_Connect}

\end{thebibliography}


\chapter{Topology}

Topology is representation of videoconferencing devices from various 
technologies and its' mutual reachability in a single domain. Each domain 
controller in Shongo will keep in memory the local topology of all devices 
which the controller manages and which are part of controller reservations (unmanaged or foreign devices but only as single nodes without theirs topology).
Controller will not know topologies from foreign domains. Every time when the 
controller needs some information about foreign devices it send request to 
foreign domain controller.

Topology is composed of nodes and edges. Nodes represents videoconference 
devices and edges theirs reachability in a specific technology (e.g., ability 
to communicate in H.323). The reachability is determined by devices' capabilities and by list of global rules which defines the additional constraints.

\section{Node}

Each node in Topology represents one videoconference device. Device is able to 
communicate with one or more \textbf{technologies} (H.323, SIP, Adobe Connect, 
etc.).
\\
Device can have one or more \textbf{capabilities}. Each capability can specify 
one or more device \textbf{technologies} to which it is provided. Capabilities 
can be from the following types:

\begin{itemize}
\newcommand{\RequireCapability}[1]{(requires #1)}
\newcommand{\ExtendCapability}[1]{(extends #1)}

\item \textbf{Standalone Terminal} \\
  Capability tells that device is a terminal that is able to communicate to
  other standalone terminal directly without \textbf{Mixing} or \textbf{Virtual 
  Rooming} device (e.g., H.323 and SIP terminals are generally standalone 
  terminal devices but Adobe Connect client is not standalone device because it 
  always needs the Adobe Connect server to start a videoconference).
  
\item \textbf{Receive}/\textbf{Send} \\
  Capability allows for receiving/sending through a limited (or unlimited) 
  number of the \textbf{input}/\textbf{output channels}. Each channel must 
  contain at least one of the following \textbf{streams}:
  \begin{itemize}
    \item \textbf{audio} in a specific \textbf{audio codecs} and 
      \textbf{bitrates}.
    \item \textbf{video} in a specific \textbf{video codecs} and 
      \textbf{resolutions}.
    \item \textbf{content} in a specific \textbf{content formats}.
  \end{itemize} 
  
\item \textbf{Mix} \RequireCapability{\textbf{Receive} and \textbf{Send}} \\
  Capability allows for mixing of multiple input channels and send 
  the combined result through one output channel. To each input channel can be connected one other device (each other device sends different data -- unicast). To each output channel can be connected multiple other devices (each other device want to receive the same data -- multicast).

\item \textbf{Virtual Rooming} \ExtendCapability{\textbf{Mix}} \\
  Capability allows the device to divide input channels into groups (virtual 
  rooms). \textbf{Mixing} is applied per group and each group 
  is bound to one output channel. Maximum number of output channels thus 
  defines the maximum number of virtual rooms. For each virtual room there can 
  be specified the maximum number of input channels (maximum videoconference 
  participants).

\item \textbf{Gatekeeper Client} \\
  Capability makes the device to have set an alias 
  and an address of a gatekeeper server to which it registers itself.
  The devices that are registered to the same gatekeeper server are by
  default reachable by an alias. This behavior can be changed by global rules. 
  Also the global rules are able to make reachable devices registered to 
  different gatekeeper servers.

\item \textbf{Gatekeeper Server} \\
  Capability tells that the device is gatekeeper server
  that has registry of devices and its' aliases and make that devices by default 
  reachable. Gatekeepers can have set maximum number of connections that may
  be established through the gatekeeper by aliases.

\item \textbf{Translate} \RequireCapability{\textbf{Receive} and \textbf{Send} 
  and at least 2 \textbf{technologies}} \\
  Capability allows for translation from one input channel to another output 
  channel where the first channel is from one specified technology and the 
  second is from another specified technology. By default all translations from 
  input to output channels are allowed. The list of \textbf{rules} can be used 
  to restrict the allowed translations (e.g., for specific codecs, resolutions, etc.).

\item \textbf{Stream} \RequireCapability{\textbf{Receive}} \\
  Capability tells that the device is able to perform streaming from an input 
  channel.

\item \textbf{Record} \RequireCapability{\textbf{Receive}} \\
  Capability tells that the device is able to perform recording from an input 
  channel.
  
\item \TODO{Do we have Managed/Unmanaged capability?}
 \\ \TODO{Managed capability would have Connector address attribute.}
 \\ \TODO{Unmanaged capability would have contact (e.g., email) to which
 are send reservations calendars.}
\end{itemize}

Each device can have one or more described capabilities. If device supports 
for instance receiving/sending in multiple technologies, it can be implemented 
by multiple capability of the same type (one for each technology) or by single 
capability that lists all the technologies (provided that all technologies has same \textbf{channels} settings).

\subsection*{Examples of abstract devices (each with technology dependent examples):}

\lstnewenvironment{TopologyExample}[2]{%
    \vspace{2mm}
    \lstset{
        basicstyle=\footnotesize\ttfamily,
        aboveskip=0pt,
        belowskip=0pt,           
        xleftmargin=8pt,
        classoffset=0,
        alsoletter={7},
        morekeywords={SIP, H323, AdobeConnect, StandaloneTerminal, Receive, 
            Send, Mix, VirtualRooming, GatekeeperServer, GatekeeperClient,
            H264, CIF, 720p,
            Address, Alias, Enable, Disable},
        keywordstyle=\textbf,
        classoffset=1,
        morekeywords={technologies, capabilities, type, channels, count},
        keywordstyle=\color{black},
        morecomment=[l]{//},     
        commentstyle=\color{gray},
    }
    \minipage{\textwidth}
    \advance\leftmargini -3mm \quote
    \footnotesize\ttfamily \textbf{#1} = \{
    \ifx&#2& \else {\color{gray}// #2} \fi
}{%
    \vspace*{-4pt}
    \footnotesize\ttfamily \}
    \endquote
    \endminipage
}

\begin{itemize}

\item \textbf{Terminal device} \\
  Terminal device is hardware or software client that is used by an user to 
  connect to a videoconference. The device allow an user to participate only in
  one videoconference at the time thus it has \textbf{Receive} and 
  \textbf{Send} capability but limited to 1 channel. It can have also the 
  \textbf{Standalone Terminal} capability which allows the terminal devices to  
  establish also 2-point videoconferences. 
  
\begin{TopologyExample}{terminal1}{Example of terminal for H.323 and/or SIP}
technology: [H323, SIP],
capability: [
  {type: StandaloneTerminal, technology: *},
  {type: Receive, channel: {count: 1}}, // "technology: *" is by default
  {type: Send, channel: {count: 1}}
]
\end{TopologyExample}

\begin{TopologyExample}{terminal2}{Example of terminal (client) for Adobe Connect}
technology: AdobeConnect,
capability: [
  {type: [Receive, Send], channel: {count: 1}},
]
\end{TopologyExample}

\begin{TopologyExample}{terminal3}{Example of H323 terminal}
// It can process arbitrary audio, but video only in H.264 (CIF -- 720p)
// It cannot process content
technology: H323,
capability: [
  {type: [Receive, Send], channel: {
    count: 1, 
    stream: {
      audio: *,
      video: {codec: H264, resolution: [CIF..720p]}
    }  
  }}
]
\end{TopologyExample}

\item \textbf{Terminal device with virtual room} \\
  Terminal device with a single embedded virtual room is extension of terminal 
  device that allows user to host a single multipoint videoconference. The 
  device has \textbf{Receive} capability with limited number of input channels 
  to number of allowed participants in the provided single virtual room. It also 
  has \textbf{Send} capability but limited to 1 channel. The last provided 
  capability is \textbf{Mix} which combines input channels to a single output 
  channel and through it mediates the multipoint videoconference. It is worth 
  to note that the terminal device with embedded virtual room itself is part of 
  the hosted videoconference.
  
\begin{TopologyExample}{terminal4}{Example of terminal with one virtual room for H.323 and/or SIP}
technology: [H323, SIP],
capability: [
  {type: Receive, channel: {count: 9}}, // max 9 other participants
  {type: Send, channel: {count: 1}},
  {type: Mix}
]
\end{TopologyExample}

\item \textbf{Multipoint device} \\
  Multipoint device is a special type of device that hosts one or more virtual 
  rooms and an arbitrary device can connect to a hosted virtual room and take 
  a videoconference there. The difference between multipoint and the previous 
  device is that the multipoint device can host more than one videoconference 
  and the multipoint device isn't part of these videoconferences, it only 
  manages them. The multipoint device has \textbf{Receive}, \textbf{Send}
  and \textbf{Virtual Rooming} capabilities. Number of input 
  channels for \textbf{Receive} capability is limited to a maximum number of 
  participants in all hosted videoconferences in the device. Number of output 
  channels for \textbf{Send} capability is limited to a maximum number of 
  virtual rooms (=~videoconferences) in the device. \textbf{Virtual Rooming} 
  capability provides the ability to mix input channels to one output channel 
  that is routed to all participants in each virtual room.

\begin{TopologyExample}{mcu1}{Example of H.323 and/or SIP multipoint device}
technology: [H323, SIP],
capability: [
  {type: Receive, channel: {count: 99}}, // max 99 participants
  {type: Send, channel: {count: 9}},     // max 9 virtual rooms
  {type: VirtualRooming}
]
\end{TopologyExample}

\begin{TopologyExample}{server1}{Example of Adobe Connect server}
technology: AdobeConnect,
capability: [
  {type: Receive, channel: {count: 99}}, // max 99 participants
  {type: Send, channel: {count: *}},     // unlimited virtual rooms
  {type: VirtualRooming}
]
\end{TopologyExample}

\item \textbf{Gatekeeper device} \\
  Gatekeeper device is a special type of device that has only 
  \textbf{Gatekeeper Server} capability. All of previous device examples can 
  also have \textbf{Gatekeeper Client} capability which allows other devices
  to address them by it's alias.
    
\begin{TopologyExample}{gatekeeper1}{Example of gatekeeper for H.323}
technology: H323,
capability: [
  {type: GatekeeperServer, max-connection: 99}
]
\end{TopologyExample}

\begin{TopologyExample}{gatekeeper2}{Example of gatekeeper for SIP}
technology: SIP,
capability: [
  {type: GatekeeperServer, max-connection: 55}
]
\end{TopologyExample}

\begin{TopologyExample}{mcu2}{Example of MCU that is registered to H.323 and SIP gatekeepers}
technology: [H323, SIP],
capability: [
  {type: [Send, Receive], channel: {count: 99}},
  {type: VirtualRooming, room: [room1, room2]},
  {type: GatekeeperClient, technology: H323, server: gatekeeper1,
     alias: {room1: 9500000002, room2: 9500000003}},
  {type: GatekeeperClient, technology: SIP, server: gatekeeper2,
     alias: {room1: sip:room1@cesnet.cz}} // room2 is registered only to H.323
]
\end{TopologyExample}

\begin{TopologyExample}{terminal5}{Example of terminal that is registered to H.323 and SIP gatekeepers}
technology: [H323, SIP],
capability: [
  {type: [Send, Receive], channel: {count: 1}},
  {type: GatekeeperClient, technology: H323, server: gatekeeper1,
     alias: 9500000001},
  {type: GatekeeperClient, technology: SIP, server: gatekeeper2,
     alias: sip:srom@cesnet.cz}
]
\end{TopologyExample}

\end{itemize}
 

\section{Edge}

The oriented edge is a link between two nodes and it tells that the second node (the node with incoming arrow) is reachable from the first node. A bidirectional edge tells that either node is reachable to the other node. Each edge is bound to a specific \textbf{technology} (e.g., H.323 or SIP) and to a specific \textbf{type} of connection in the technology (e.g., in H.323 may be endpoints reachable by IP address or by H.323 alias, if both is available two edges must be present). Each edge also specifies number of \textbf{channels} that are available between the nodes (devices) and for each channel is specified set of \textbf{streams} that can be used.

\begin{TopologyExample}{gatekeeper}{}
technology: SIP,
capability: [{type: GatekeeperServer}]
\end{TopologyExample}

\begin{TopologyExample}{terminal1}{}
address: 147.251.99.1,
technology: [H323, SIP],
capability: [
  {type: StandaloneTerminal},
  {type: [Send, Receive], channel: {count: 1}}, 
  {type: GatekeeperClient, technology: SIP, server: gatekeeper, alias: sip:1}
]
\end{TopologyExample}

\begin{TopologyExample}{terminal2}{}
address: 147.251.99.2,
technology: [H323, SIP],
capability: [
  {type: StandaloneTerminal},
  {type: [Send, Receive], channel: {count: 1}}, 
  {type: GatekeeperClient, technology: SIP, server: gatekeeper, alias: sip:2}
]
\end{TopologyExample}

\begin{TopologyExample}{edge1}{terminal1 <-> terminal2}
technology: H323,
type: Address,
channel: {count: 1}
\end{TopologyExample}

\begin{TopologyExample}{edge2}{terminal1 <-> terminal2}
technology: SIP,
type: Alias,
channel: {count: 1}
\end{TopologyExample} 
  
  
\section{Rule}
Rules in Topology are at global level and they are used for modifying the default reachability (determined by nodes capability settings). Each rule must specify a target \textbf{technology}, a \textbf{type} of connection in the technology (\verb|Address| or \verb|Alias|), nodes (or groups of nodes) to which the rule is applied and modifier (\verb|Enable| or \verb|Disable|) which tells whether the reachability will be enabled or disabled. The nodes can be specified by pattern for identifier, address or alias. If more than one group of nodes is specified then the rule is applied only for edges between the groups and not inside the groups.

\begin{TopologyExample}{rule1}{Disable reachability by IP address for all H.323 devices}
technology: H323,
type: Address,
node: *,
goal: Disable
\end{TopologyExample}

\begin{TopologyExample}{rule2}{Enable reachability by IP address for all H.323 devices at FI MUNI}
technology: H323,
type: Address,
node: cz.muni.fi.*,
goal: Enable
\end{TopologyExample}

\begin{TopologyExample}{rule3}{}
// Enable reachability by alias of SIP and H.323 devices between two networks.
// Devices from each network are referenced by the network gatekeeper.
technology: [H323, SIP],
type: Alias,
node: [gatekeeper1.*, gatekeeper2.*],
goal: Enable
\end{TopologyExample}

\begin{TopologyExample}{rule3}{Enable all correct reachability}
technology: *,
type: *,
node: *,
goal: Enable
\end{TopologyExample}


\section{Examples}

\TODO{Show some complex Topology examples}


%\chapter{Technology Implementation in Topology}
%Each videoconference network in a specific technology can be implemented by Topology. This chapter shows examples of network implementation for each technology.
%\TODO{Show examples}
%\section{H.323}
%\section{SIP}
%\section{Adobe Connect}


\chapter{Topology Implementation}

Topology implementation should allow dynamic modification when for instance some device parameters are changed to not force the whole topology reconstruction.      
      
\section{Construction}

Construction is performed when the controller is started. Steps to construct a topology:

\begin{enumerate}

\item Get the list of all devices with it's capabilities in a topology.

\item For each device: 
  \begin{compactitem}
  \item Find all other devices that the device is able to transmit
  data to (or to make a call) and for each:
    \begin{compactitem}
    \item Add edge with proper parameters.
    \end{compactitem}
  \end{compactitem}

\end{enumerate}     
     
\section{Update Topology}     

Steps to update a topology when the capabilities for a device are changed:
\begin{enumerate}

\item Remove all edges that reference the device.

\item Find all other devices that the device is able to transmit data from/to
   (or to make a call) and for each:
   \begin{compactitem}
   \item Add edge(s) with proper parameters.
   \end{compactitem}

\end{enumerate}  

\TODO{Continue in describing implementation}


\chapter{Scheduler}

Scheduler is a component of a domain controller that has access to a database of domain resources and reservations. Scheduler allocates the requested resources by reservations to specific time slots and specific resources according to requested parameters and optimization criteria.

Scheduler should keep in memory the database of resources in efficient form. There are following types of resources:
\begin{compactitem}
\item Device
\item Virtual Room
\item License
\item Identifier
\item Physical Room
\item Other
\end{compactitem}
The device resources will be kept in Topology representation, that was described in previous chapter. Virtual room resources are part of the multipoint devices thus the virtual rooms are kept inside the multipoint devices in the Topology. Licenses represents active videoconference channels on infrastructure elements (e.g., multipoint devices or gatekeepers) and are kept also inside the devices in the Topology. Identifier resource represents a device alias in specific technology. All identifiers will be kept aside from the Topology and will be allocated from ranges that was defined to a Shongo controller. For each technology Shongo should get specified the range of aliases that it can allocate to reservations. Physical rooms and other resources will be kept aside from the Topology and will be allocated separately.

Each resource can have set that it is located inside another resource, for instance H.323 terminal can be located inside physical room. When scheduler allocates resource, it must also allocate resource in which the requested resource is located (recursively).

\TODO{Do we create LocatedIn capability? Or all resource will have the attribute?}

\paragraph{Resource}
\begin{compactitem}
\item Has some attributes (e.g., identifier, name, etc.).
\item Has \textbf{resource type} enum attribute (one of: Device, Virtual Room, Licence, Identifier, Physical Room, Other).
\item A resource type can restrict what other resource types may be located inside it or in which resource types it can be located.
\item Has some capabilities (e.g., StandaloneTerminal, Receive, Send, etc.).
\item Each capability can restrict in which resource types may be used (or resource type may restrict which capabilities can have).
\item There will be more capabilities (e.g., Located In, Managed/Unmanaged).
\item Capability can be part of a set, and resource type may request that the resource has exactly one capability from that set (e.g., Manage/Unmanaged). 
\end{compactitem}

\paragraph{Scheduler optimization criteria:}
\begin{compactitem}
\item Minimize resource utilization
\item Maximize available continuous time slots for resources (minimize fragmentation)
\end{compactitem}

\TODO{Continue in describing scheduler}

\end{document}