\documentclass[a4paper]{report}
\usepackage{geometry}
\geometry{paper=a4paper}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenx}
\usepackage{palatino}
\usepackage{mathpazo}
\usepackage{microtype}
\renewcommand*\ttdefault{txtt}

\usepackage[czech,english]{babel}

\usepackage[pdftex,breaklinks=true,pdfborder={0 0 0}]{hyperref}
\usepackage[pdftex]{graphicx}
\usepackage{paralist} 
\usepackage{multicol}

\usepackage{tikz}
\usetikzlibrary{snakes,arrows,shapes,calc}
\usepackage{amsmath}
\usepackage[numbers]{natbib}

\usepackage{xcolor}
\newcommand{\TODO}[1]{%
\def\empty{}%
\def\prvniparametr{#1}%
\ifx\prvniparametr\empty%
\begingroup\tt\textcolor{red}{\noindent\textbf{TODO}}\endgroup
\else%
\begingroup\tt\textcolor{red}{\noindent\textbf{TODO:}\ #1}\endgroup
\fi%
}

\input{graph.tex}


\begin{document}


\title{Scheduler for Shongo}
\author{Petr Holub, Jan Růžička, Miloš Liška, Martin Šrom, Ondřej Pavelka, Ondřej Bouda}
\date{\copyright~CESNET~z.\,s.\,p.\,o.\\2012}
\maketitle
\tableofcontents


\chapter{Technology}

This chapter describes widely-used videoconference technologies. Element types and network examples are listed  for each technology.


\section{H.323}

The H.323 network is composed of terminals, multipoint control units, gateways and gatekeepers. Terminals, MCUs and gateways are referred to as endpoints. At least two terminals are needed to start a videoconference call.

\subsection{Elements}

\begin{itemize}

\item \textbf{Terminal} \\
Terminal represents a hardware device or a software client that enables a single person or a group of persons situated in front of the device to connect to another H.323 endpoint and take a videoconference call.

There are special terminal devices that provides a single virtual room to which can connect multiple other endpoints.  These terminals thus allow to make a multipoint videoconference even without the MCU.

\item \textbf{Multipoint Control Unit} (MCU) \\
MCU represents a hardware device that is used for hosting of videoconference calls in which can generally participate any number of endpoints. MCU contains one or more \textbf{virtual rooms} and each virtual room can host one videoconference call at the time. MCU can restrict the number of participants per virtual room or per whole MCU device.

\item \textbf{Gateway} \\
Gateway is device that enable communication between H.323 network and other network (e.g., PSTN).

\item \textbf{Gatekeeper} \\
Gatekeeper is a hardware device that provides special services to the other elements in the network: endpoint registration, address resolution, admission control and user authentication.

\end{itemize}

Each H.323 element is running on specific IP address that can be used to connect to the element. An element can have assigned alias, \textbf{H.323 phone number} (sequence of digits) or \textbf{H.323 identifier} (string, e.g., email), that can be used to connect to it. It is useful when the IP address is not known (e.g., the device is behind the NAT) or it is likely to change (organization changes).

Alias can be assigned only to \textbf{terminal} or \textbf{virtual room} in MCU. When an terminal has assigned alias it must register to one \textbf{gatekeeper} that will be able to translate the alias to the terminal IP address. When an element want to connect to another terminal or virtual room by alias, it must use the same gatekeeper that has the proper registry of aliases.

When a gatekeeper is used in videoconference, it can work in two modes:
\begin{itemize}
\item Direct Endpoint Model -- The gatekeeper is used only for initialization (address resolution, admission control, etc.) and the videoconference call itself is managed by it's participants (endpoints). The gatekeeper doesn't have full control over the call signaling. The target IP address is communicated to the caller.
\item Gatekeeper Routed Model -- The gatekeeper is used throughout videoconference call, the call signaling flow through the gatekeeper and it has the full control over it. The target IP address is not communicated to the caller.
\end{itemize}

Each terminal and MCU element can have set zero or one gatekeeper. If gatekeeper is set then each terminal and virtual room in MCU can have an alias set. Each terminal and MCU element should also be configured to allow or forbid the direct connections through IP address. When the gatekeeper with admission control is set, it is appropriate to forbid direct connections through IP address.

\subsection{Constraints}

\begin{itemize}

\item Communication consists of:
\begin{compactenum}
\item Audio
\item Audio + Video
\item Audio + Data
\item Audio + Video + Data
\end{compactenum}

\item Always bidirectional connections. When an device $A$ can connect to a device $B$ then also $B$ can connect to $A$.
\\ \TODO{Do we want to know in Abstract Topology which of 4 modes each device support?}

\end{itemize}

\subsection{Network Examples}

\subsubsection{Connection through direct IP addresses}

Terminals and virtual rooms in MCU don't have assigned any H.323 aliases thus the connecting is done through IP addresses. This topology allows for 2-point videoconferences (e.g., \emph{terminal1 -- terminal2}) and multipoint videoconferences through the MCU (e.g., \emph{terminal1 -- terminal2 -- terminal3 -- mcu}). When an terminal connects to the MCU it must select the proper virtual room, because the IP address determines only the MCU not the specific virtual room.

\begin{Graph}{graph:h323:direct}{Connection through direct IP addresses}
  \Vertex{0, 0}{t1}{terminal1}
  \Vertex{4, 0}{t2}{terminal2}
  \Vertex{4,-4}{t3}{terminal3}
  \Vertex{0,-4}{mcu}{mcu}
  
  \EdgeAllToAll{<->}{ip, data, control}{t1, t2, t3, mcu}
  
  \GraphLegendAll{6, -1.5}
\end{Graph}

\subsubsection{Connection through a gatekeeper (Direct Endpoint Model)}

Terminals and MCUs are configured to forbid direct connections through IP addresses. Terminals and MCU virtual rooms have assigned H.323 aliases and the devices register to the gatekeeper that is able to resolve these aliases to direct IP addresses. When terminal want to start videoconference he must request the gatekeeper. The request must contain H.323 alias of another terminal or virtual room in MCU to which the terminal wants to connect. The gatekeeper resolves an IP address from the alias and return it to the caller which then is able to start videoconference data flow to the requested target.

\begin{Graph}{graph:h323:gatekeeper}{Connection through gatekeeper}{}
  \Vertex{ 0, 0}{t1}{terminal1}
  \Vertex{ 4, 0}{t2}{terminal2}
  \Vertex{ 4,-4}{t3}{terminal3}
  \Vertex{ 0,-4}{mcu}{mcu}
  \Vertex{-2,-2}{gk}{gatekeeper}
  
  \EdgeAllToAll{<->}{data, control}{t1, t2, t3, mcu}
  \EdgeOneToAll{<->}{alias}{gk}{t1, t2, t3, mcu}
  
  \GraphLegendAll{6, -1.5}
\end{Graph}

\subsubsection{Connection through a gatekeeper (Gatekeeper Routed Model)}

Terminals and MCUs are configured to forbid direct connections through IP addresses. Terminals and MCU virtual rooms have assigned H.323 aliases and the devices register to the gatekeeper that is able to resolve these aliases to direct IP addresses. When terminal want to start videoconference he must request the gatekeeper. The request must contain H.323 alias of another terminal or virtual room in MCU to which the terminal wants to connect. The gatekeeper resolves an IP address from the alias and establish connection to the target endpoint. The call is then mediated by the gatekeeper throughout the videoconference.

\begin{Graph}{graph:h323:gatekeeperRouted}{Connection through gatekeeper}{}
  \Vertex{0, 0}{t1}{terminal1}
  \Vertex{4, 0}{t2}{terminal2}
  \Vertex{4,-4}{t3}{terminal3}
  \Vertex{0,-4}{mcu}{mcu}
  \Vertex{-2,-2}{gk}{gatekeeper}
  
  \EdgeAllToAll{<->}{data}{t1, t2, t3, mcu}  
  \EdgeOneToAll{<->}{alias, control}{gk}{t1, t2, t3, mcu}
  
  \GraphLegendAll{6, -1.5}
\end{Graph}

\subsubsection{Multiple gatekeepers (Gatekeeper Routed Model)}

The network is composed from 3 endpoints (\emph{terminal1, terminal2, mcu}) managed by \emph{gatekeeper1} and 2 subdomains where each is composed of 2 endpoints and one gatekeeper. 
\begin{Graph}{graph:h323:gatekeeperMultiple}{Multiple gatekeepers}{}
  \Vertex{ 0, 0}{gk1}{gatekeeper1}
  \Vertex{-2,-2}{gk2}{gatekeeper2}
  \Vertex{ 2,-2}{gk3}{gatekeeper3}
  \EdgeAllToAll{<->}{alias, control}{gk1, gk2, gk3}
  
  \Vertex{-2, 2}{t1}{terminal1}
  \Vertex{ 2, 2}{t2}{terminal2}
  \Vertex{ 0, 4}{mcu}{mcu}
  \EdgeAllToAll{<->}{ip, control, data}{t1, t2, mcu}  
  \EdgeOneToAll{<->}{alias, control}{gk1}{t1, t2, mcu}  

  \Vertex{-5,-1}{t3}{terminal3}
  \Vertex{-5,-3}{t4}{terminal4}
  \Edge{<->}{ip, control, data}{t3}{t4}
  \EdgeOneToAll{<->}{alias, control}{gk2}{t3, t4}  
     
  \Vertex{5,-1}{t5}{terminal5}
  \Vertex{5,-3}{t6}{terminal6}
  \Edge{<->}{ip, control, data}{t5}{t6}
  \EdgeOneToAll{<->}{alias, control}{gk3}{t5, t6}    
  
  \Edge{<-}{dataDashed}{mcu}{$(mcu) + (0,1)$}
  \Edge{<-}{dataDashed}{t1}{$(t1) + (-1.5,0)$}
  \Edge{<-}{dataDashed}{t2}{$(t2) + (1.5,0)$}
  \Edge{<-}{dataDashed}{t3}{$(t3) + (0, 1)$}
  \Edge{<-}{dataDashed}{t4}{$(t4) + (0,-1)$}
  \Edge{<-}{dataDashed}{t5}{$(t5) + (0, 1)$}
  \Edge{<-}{dataDashed}{t6}{$(t6) + (0,-1)$}

  \GraphLegendAll{4, 4}
\end{Graph}
Adjacent endpoints (endpoints in the same local network) can connect directly or through it's gatekeeper. Not adjacent endpoints (endpoints from different local networks) can connect only by it's gatekeepers.

\subsection{References}

\renewcommand{\bibsection}{}
\begin{thebibliography}{1}
\bibitem[1]{bib:h323:wiki}
H.323 on Wikipedia.
\\\url{https://en.wikipedia.org/wiki/H.323}

\bibitem[2]{bib:h323:architecture}
Basic Architecture of H.323.
\\\url{http://hive1.hive.packetizer.com/users/packetizer/papers/h323/h323_basics_handout.pdf}

\bibitem[3]{bib:h323:gatekeepers}
Understanding H.323 Gatekeepers
\\\url{http://www.cisco.com/en/US/tech/tk1077/technologies_tech_note09186a00800c5e0d.shtml}
\end{thebibliography}


\section{SIP}

\TODO{Describe SIP}

\subsection{Elements}

Type of elements in SIP network:

\begin{itemize}
\item \textbf{User Agent} \\
TODO
\item \textbf{Proxy Server} \\
TODO
\item \textbf{Redirect Server} \\
TODO
\item \textbf{Registrar} \\
TODO
\end{itemize}

\subsection{Constraints}

\begin{itemize}

\item Communication consists of:
\begin{compactenum}
\item Audio
\item Audio + Video
\item Audio + Video + Data
\end{compactenum}

\end{itemize}

\subsection{Network Examples}

\subsection{References}

\renewcommand{\bibsection}{}
\begin{thebibliography}{1}

\bibitem[1]{bib:sip:architecture}
Session Initiation Protocol (SIP)
\\ \url{http://www.vide.net/cookbook/cookbook.en//list_page.php?topic=3&url=sip.htm}

\bibitem[2]{bib:sip:wiki}
Session Initiation Protocol on Wikipedia.
\\ \url{https://en.wikipedia.org/wiki/Session_Initiation_Protocol}

\end{thebibliography}


\section{Adobe Connect}

\TODO{Describe Adobe Connect}


\chapter{Abstract Topology}

Abstract topology is representation of videoconferencing devices from various technologies and it's relations. Each domain controller in Shongo will keep in memory the local topology of all devices that the controller manages.
Controller will know nothing about topologies from foreign domains. Every time when the controller needs some information about foreign devices it send request to foreign domain controller.

Abstract topology is composed of nodes and edges. Nodes represents a videoconference devices and and edges theirs relations, ability to communicate.

\section{Node}

Each node in Abstract Topology represents one videoconference device. Device is able to communicate with one or more technologies (H.323, SIP, Adobe Connect, etc.).
\\
If device is able to communicate with a \textbf{technology} it means that it 
has at least one capability from the following types (for that technology):
\begin{compactitem}
\item \textbf{receive} and/or \textbf{send} through a limited number of 
  the technology input/output \textbf{channels}. Each channel must contain 
  at least one of the following \textbf{streams}:
  \begin{itemize}
    \item \textbf{audio} in a specific \textbf{audio codecs} and 
      \textbf{bitrates}.
    \item \textbf{video} in a specific \textbf{video codecs} and 
      \textbf{resolutions}.
    \item \textbf{content} in a specific \textbf{content formats}.
  \end{itemize} 
\item \textbf{mix} input channels and send the combined result through 
  an output channel.
\item \textbf{virtual rooming} means that the device divides input channels 
  into groups (virtual rooms), \textbf{mixing} is applied per group and
  each group is bound to one output channel. For each virtual room there can 
  be specified the maximum number of input channels (maximum videoconference 
  participants).
\item \textbf{gatekeeper client} means that the device has set an alias 
  and an address of a gatekeeper server to which it registers itself.
  When the device want to connect to another device by an alias it contacts 
  the gatekeeper server which resolves the device address from the alias 
  or route the videoconference through the gatekeeper server (and do not tell
  the resolved address to the caller).
\item \textbf{gatekeeper server} means that the device is gatekeeper server
  that has registry of devices and its' aliases. The gatekeeper server is
  able to resolve addresses or route the videoconference through itself. It is 
  able to perform an admission control or user authentication.
\item \textbf{stream} from an input channel.
\item \textbf{record} from an input channel.
\item \TODO{Describe used capacity by scheduler...}
\end{compactitem}
Each device can have one or more described capabilities for each technology
that it supports.
If device is able to communicate with a multiple technologies it can also have the following capabilities:
\begin{compactitem}
\item \textbf{translate} the technology input channel to another technology output 
  channel.
\end{compactitem}


\subsection*{Examples of abstract devices (not bound to any technology):}
\begin{itemize}
\item \textbf{Terminal device} \\
  Terminal device is hardware or software client that is used by an user to 
  connect to a videoconference. The device allow user to participate only in
  one videoconference at the time thus it has \textbf{receive} and 
  \textbf{send} capability but limited to 1 channel. No other capability is 
  provided by the simple terminal device. If we have available only terminal 
  devices we are able to establish only 2-point videoconferences 
  (terminal-to-terminal links).

\item \textbf{Terminal device with embedded virtual room} \\
  Terminal device with embedded virtual room is extension of terminal device 
  that allows user to host a single multipoint videoconference. The device has 
  \textbf{receive} capability with limited number of input channels to number 
  of allowed participants in the provided single virtual room. It also has 
  \textbf{send} capability but limited to 1 channel. The last provided 
  capability is \textbf{mix} which combines input channels to a single output 
  channel and through it mediates the multipoint videoconference. It is worth 
  to note that the terminal device with embedded virtual room itself is part of 
  the hosted videoconference.

\item \textbf{Multipoint device} \\
  Multipoint device is a special type of device that hosts one or more virtual 
  rooms and an arbitrary device can connect to a hosted virtual room and take 
  a videoconference there. The difference between multipoint and the previous 
  device is that the multipoint device can host more than one videoconference 
  and the multipoint device isn't part of these videoconferences, it only 
  manages them. The multipoint device has \textbf{receive}, \textbf{send} and 
  \textbf{virtual rooming} capabilities. Number of input channels for 
  \textbf{receive} capability is limited to a maximum number of participants 
  in all hosted videoconferences in the device. Number of output channels for 
  \textbf{send} capability is limited to a maximum number of virtual rooms 
  (=~videoconferences) in the device. \textbf{Virtual rooming} capability 
  provides the ability to mix input channels to one output channel 
  that is routed to all participants in each virtual room.

\item \textbf{Gatekeeper device} \\
  Gatekeeper device is a special type of device that has only 
  \textbf{gatekeeper server} capability. All of previous device examples can 
  also have \textbf{gatekeeper client} capability which allows them to use a 
  device alias as a videoconference callee specification. When device alias is 
  used for initiating the videoconference then the device contacts the proper 
  gatekeeper which has two options: to resolve address from the alias and 
  return it to the caller or to route the videoconference through the 
  gatekeeper.
\end{itemize}
 

\section{Edge}

Edge links two nodes (devices) and it represents a relation between the 
nodes. The relation can have a various meaning, for instance that the devices
are able to take a videoconference together in a specific technology or
that the first device is a gatekeeper and the second can resolve a device 
address from an alias (in specific technology as well).
\\
The edge can represents a relation in one or more technologies. For each \textbf{technology} that the edge relates to, the edge can have one or more 
capabilities from the following types:
\begin{compactitem}   
\item \textbf{channel} means that between two devices can be established
  a communication channel. It must contain at least one of the following 
  \textbf{streams}:
  \begin{itemize}
    \item \textbf{audio} in a specific \textbf{audio codecs} and 
      \textbf{bitrates}.
    \item \textbf{video} in a specific \textbf{video codecs} and 
      \textbf{resolutions}.
    \item \textbf{content} in a specific \textbf{content formats}.
  \end{itemize} 
  
\item \TODO{Describe weights...}
   \\ \TODO{Describe used capacity by scheduler...}
\end{compactitem}   
  

\chapter{Technology Implementation in Abstract Topology}
Each videoconference network in a specific technology can be implemented by Abstract Topology. This chapter shows examples of network implementation for each technology.

\TODO{Show examples}

\section{H.323}

\section{SIP}

\section{Adobe Connect}


\chapter{Abstract Topology Implementation}

\TODO{Describe implementation better}

Topology implementation should allow dynamic modification when for instance some device parameters are changed to not force the whole topology reconstruction.      
      
\section{Construction}

Construction is performed when the controller is started. Steps to construct a topology:

\begin{enumerate}

\item Get the list of all devices with it's capabilities in a topology.

\item For each device: 
  \begin{compactitem}
  \item Find all other devices that the device is able to transmit
  data to (or to make a call) and for each:
    \begin{compactitem}
    \item Add edge with proper parameters.
    \end{compactitem}
  \end{compactitem}

\end{enumerate}     
     
\section{Update Topology}     

Steps to update a topology when the capabilities for a device are changed:
\begin{enumerate}

\item Remove all edges that reference the device.

\item Find all other devices that the device is able to transmit data from/to
   (or to make a call) and for each:
   \begin{compactitem}
   \item Add edge(s) with proper parameters.
   \end{compactitem}

\end{enumerate}  


\chapter{Scheduler}

Scheduler will use described abstract topology implementation for scheduling reservations of videoconference devices.

\TODO{Describe scheduler}


\end{document}