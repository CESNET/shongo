\chapter{Scheduler}

\newcommand{\SchedulerInputCode}[1]{
\UseCodeStyle{
  Object, Enum, Integer, String, Boolean, List,  
  IP-Address, URL, URN, 
  extends, of, or, *
}
\vspace{2mm}
\lstinputlisting{#1}
}

Scheduler is a component of a domain controller that has access to a database 
of domain resources and reservations. Scheduler allocates the requested 
resources by reservations to specific time slots and specific resources 
according to requested parameters and optimization criteria.

\section{Resource Database}

Resource is physical or logical entity that can be scheduled by a scheduler. 
Resources are persistently stored in a relational database. Scheduler has 
access to that database and should keep the resources in memory in an 
efficient form for scheduling. Some of resources are created by Shongo users 
(e.g., videoconference devices or physical rooms), some are created by Shongo 
scheduler (e.g., virtual rooms or identifiers) and some are created due to a 
reservation request (e.g., unmanaged devices or resources from foreign 
domains). Resource database is composed of:
\begin{compactenum}
\item List of all known resources.
\item Device Topology that contains all device resources and represents 
videoconference reachability between them.
\end{compactenum}
Each resource can be one of the following types:
\begin{compactenum}
\item \textbf{Device} -- represents a videconference harware or software 
  element.
\item \textbf{Device Component} -- represents a resource that is a part of a 
  device resource. Can be one of the following types:
  \begin{compactenum}
    \item \textbf{Identifier}
    \item \textbf{Virtual Room}
    \item \textbf{License}
  \end{compactenum}
\item \textbf{Physical Room} -- represent a physical room (e.g., classroom or 
  boardroom).
\item \textbf{Other} -- \TODO{Examples?}
\end{compactenum}
Each resource can be dependent on another resource (e.g., can be located 
inside it or can be part of it), for instance a H.323 terminal can be located 
inside a physical room or a H.323 identifier is assigned to a H.323 device. 
When scheduler allocates resource, it must also allocate a resource to which 
the requested resource is dependent (recursively).

\TODO{Do we create LocatedIn capability (with resource and alsoReservate 
attributes)? Or all resource will have the attribute locatedIn and 
alsoReservate?}

\paragraph{Resource}
\begin{compactitem}
\item Has some attributes (e.g., identifier, name, etc.).
\item Is one of the resource type.
\item Can be dependent on another resource. \TODO{Or on more resources?}
\item A resource type can restrict what other resource types may be dependent 
  to it or to which resource types it can be dependent.
\item Has some capabilities (e.g., StandaloneTerminal, Receive, Send, etc.).
\item Each capability can restrict in which resource types may be used (or 
  resource type may restrict which capabilities can have).
\item There will be more capabilities (e.g., Located In, Managed/Unmanaged).
\item Capability can be part of a set, and resource type may request that the 
  resource has exactly one capability from that set (e.g., device must be   
  Managed or Unmanaged). 
\end{compactitem}

\subsection{Implementation}

The resource database is implemented as follows:

\SchedulerInputCode{chapter_scheduler_resources.txt}

\subsection{Operations}

Operations that can be performed on resource database:

\begin{description}
\item[Construct]
Resource database is constructed when the controller (and thus the scheduler) 
is started. The scheduler loads all resources from relational database and 
performs \textbf{Add new resource} for each loaded resource.

\item[Add new resource]
The scheduler adds the resource to the list of all resources. If the resource 
is device type then the resource is also added to the Device Topology.

\item[Remove existing resource]
The scheduler removes the resource from the list of all resources. If the 
resource is device type then the resource is also removed from the Device 
Topology.
\end{description}

\section{Scheduling}

Scheduler holds the resource database and waits for incoming reservations. When a reservation arise, the scheduler performs scheduling operation. Each reservation can request multiple reservation events. So the first step that
scheduler should do with a new reservation is to break it (enumerate it) to
all reservation events. If infinite reservations are allowed the scheduling must run with a set maximum future date to which the planning will be done.

\paragraph{Scheduling of a reservation event}
{
\renewcommand{\labelenumi}{\arabic{enumi}.}
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}}
\begin{compactenum}
\item ...
  \begin{compactenum}
  \item ...
  \item ...
  \end{compactenum}
\item ...
\end{compactenum}
}

\SchedulerInputCode{chapter_scheduler_reservations.txt}

\TODO{Continue in describing scheduler}

\paragraph{Scheduler optimization criteria:}
\begin{compactitem}
\item Minimize resource utilization
\item Maximize available continuous time slots for resources (minimize 
  fragmentation)
\end{compactitem}
