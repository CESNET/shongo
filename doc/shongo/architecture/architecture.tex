\input{../preamble}
\usepackage{titlesec}

\titleformat{\chapter}[display]
    {\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}
\titlespacing*{\chapter}{0pt}{0pt}{30pt}
\addtolength{\textheight}{2cm}
\setlength{\hoffset}{-20pt}
\addtolength{\textwidth}{40pt}

\begin{document}

\title{Shongo Architecture}
\maketitle
\tableofcontents

\input{../glossaries}



\chapter{Architecture}

Shongo is a reservation system designed for booking videoconferencing resources. It is composed of several components (see fig. \ref{fig:architecture}):

\begin{enumerate}

\item \textbf{Controller} is the main backend application for a single domain written in Java which holds a relational database of resources, reservation requests and all other entities. Controller provides an XML-RPC API which is used by clients to manage the relational database and to control managed devices for the domain.

\item \textbf{Web/Cmd-line Client} is an application written in Perl which allows the users/administrators to access the controller (e.g., to create/modify/delete the resources and reservation requests and to control managed devices).

\item \textbf{Connector} is an application written in Java which runs one or more \textbf{Device Agents} and which mediates the communication to controller via JADE (middle-ware written in Java for creating multi-agent systems)

\item \textbf{Device Agent} is a sub-component of \textbf{Connector} which manages a single videoconferencing device (e.g., Cisco Codian MCU, Adobe Connect server, LifeSize endpoint or Tandberg Codec endpoint). It is able, for instance, to create/modify/delete a room or to dial/hangup a participant in multipoint devices or to dial/hangup on endpoints (and more).

\item \textbf{Auth Server} is a component for user authentication/authorization and for lookuping existing users from identity providers. It is used by \textbf{Web Client} for user sign up and by \textbf{Controller} to verify the user identity and to lookup user information.

\end{enumerate}

\begin{figure}[ht!]
\includegraphics[width=\textwidth]{diagrams/dd_architecture}
\caption{Architecture of Shongo reservation system}
\label{fig:architecture}
\end{figure}

Shongo isn't currently fully implemented. In the current state each Shongo instance is able to manage resources in a single domain without the inter-domain collaboration. The Shongo instance means deployed controller, web client and one or more connectors with one or more device agents. The fig. \ref{fig:architecture-implemented} shows which components and communication channels are already implemented.

\begin{figure}[ht!]
\includegraphics[width=\textwidth]{diagrams/dd_architecture_implemented}
\caption{Already implemented components in Shongo reservation system (grayed parts aren't implemented yet)}
\label{fig:architecture-implemented}
\end{figure}



\chapter{Deployment}

Shongo reservatin system for a single domain can be deployed to target machines in several ways (see fig. \ref{fig:deployment}).

\begin{figure}[ht!]
\begin{center}  
  \subfigure[All components are deployed to the same machine]{
    \label{fig:deployment:one}
    \includegraphics[width=7.5cm]{diagrams/dd_deployment_one}
  } 
  \hfill
  \subfigure[Controller and web client are deployed to the same machine and connector is deployed to another one]{
    \label{fig:deployment:two}
    \includegraphics[width=7.5cm]{diagrams/dd_deployment_two}
  } 
  \subfigure[Each component is deployed to it's own machine]{
    \label{fig:deployment:multi}
    \includegraphics[width=14cm]{diagrams/dd_deployment_multi}
  } 
\end{center}
\caption{Possible deployments of Shongo reservation system components}
\label{fig:deployment}
\end{figure}



\chapter{Controller}

Controller is composed of several sub-components:
\begin{itemize}
\item \textbf{API}
\item \textbf{Scheduler}
\item \textbf{Executor}
\item \textbf{Authorization}
\end{itemize}

\begin{figure}[ht!]
\centering\includegraphics[width=\textwidth]{diagrams/sd_reservation_request_processing}
\caption{Process of creating reservation request by an user, booking the reservation by scheduler and executing the meeting by executor}
\label{fig:resources}
\end{figure}

\section{Relational Database}

\subsection{Resources}

\begin{figure}[ht!]
\centering\includegraphics[width=0.9\textwidth]{diagrams/cd_resources}
\caption{Database schema of resources}
\label{fig:resources}
\end{figure}

\begin{itemize}
\item Terminal
\item Multipoint Devices
\item Other
\end{itemize}

\subsection{Reservation Requests}

\begin{figure}[ht!]
\includegraphics[width=\textwidth]{diagrams/cd_reservation_requests}
\caption{Database schema of reservation requests}
\label{fig:reservation-requests}
\end{figure}

\subsection{Reservations}

\begin{figure}[ht!]
\centering\includegraphics[width=0.7\textwidth]{diagrams/cd_reservations}
\caption{Database schema of reservations}
\label{fig:reservations}
\end{figure}

\subsection{Executables}

\begin{figure}[ht!]
\centering\includegraphics[width=0.8\textwidth]{diagrams/cd_executables}
\caption{Database schema of executables}
\label{fig:executables}
\end{figure}



\chapter{Communication Examples} 

\section{User}

List reservation requests with \code{RoomSpecification} for H.323 or SIP.

\noindent\textbf{Request:}
{\scriptsize\begin{verbatim}
<?xml version="1.0" encoding="UTF-8"?>
<methodCall>
  <methodName>Reservation.listReservationRequests</methodName>
  <params>
    <param>
      <value><string>0801b1c2bf40d9df766be6b29960268b8aa94533</string></value>
    </param>
    <param>
      <value><struct>
        <member>
          <name>specificationClass</name>
          <value><string>RoomSpecification</string></value>
        </member>
        <member>
          <name>technology</name>
          <value><array><data>
            <value><string>H323</string></value>
            <value><string>SIP</string></value>
          </data></array></value>
        </member>
      </struct></value>
    </param>
  </params>
</methodCall>
\end{verbatim}}

\noindent\textbf{Response:}

{\scriptsize\begin{verbatim}
<methodResponse>
  <params>
    <param>
      <value><array><data>
        <value>
          <struct>
            <member>
              <name>id</name>
              <value>shongo:cz.cesnet.srom-dev:req:2</value>
            </member>
            <member>
              <name>purpose</name>
              <value>SCIENCE</value>
            </member>
            <member>
              <name>earliestSlot</name>
              <value>2013-04-05T14:07:00.000Z/2013-04-05T14:09:00.000Z</value>
            </member>
            <member>
              <name>description</name>
              <value>Test</value>
            </member>

            ...
            
          </struct>
        </value>            
      </data></array></value>
    </param>
  </params>
</methodResponse>
\end{verbatim}}

\section{Administrator}

\nocite{*}
\bibliography{../bibliography}

\end{document}

