\documentclass[a4paper]{report}
\usepackage{geometry}
\geometry{paper=a4paper}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenx}
\usepackage{palatino}
\usepackage{mathpazo}
\usepackage{microtype}
\renewcommand*\ttdefault{txtt}

\usepackage[czech,english]{babel}

\usepackage[pdftex,breaklinks=true,pdfborder={0 0 0}]{hyperref}
\usepackage{url}
\usepackage{paralist}
\usepackage{graphicx}
\usepackage{xtab}
\usepackage{booktabs}
\usepackage{calc}
\usepackage{ifthen}
\usepackage{xspace}

% this is to protect verbatim
\usepackage{cprotect}

\newcommand{\APIcmd}[1]{\item \texttt{#1}}

\newenvironment{APIdef}{\begin{itemize}}{\end{itemize}}

%{{{
\makeatletter
% we need to take only part of the \usecounter definition for DCcounter - no
% resets are wanted after end of the environment
\newcounter{UCcounter}
\setcounter{UCcounter}{0}
\newenvironment{UseCases}%
	{\begin{list}{\textbf{UC-\arabic{UCcounter}}}{\@nmbrlisttrue\def\@listctr{UCcounter}}}%
	{\end{list}}
\newcommand{\UClabel}[1]{\label{UC:#1}}
\newcommand{\UCref}[1]{UC-\ref{UC:#1}}

\newcommand{\UseCase}[2]{\item\UClabel{#2} \textbf{#1}\\}

\makeatother
%}}}

\usepackage{xcolor}
\newcommand{\TODO}[1]{%
\def\empty{}%
\def\prvniparametr{#1}%
\ifx\prvniparametr\empty%
\begingroup\tt\textcolor{red}{\noindent\textbf{TODO}}\endgroup
\else%
\begingroup\tt\textcolor{red}{\noindent\textbf{TODO:}\ #1}\endgroup
\fi%
} 


\begin{document}

\title{API for Shongo}
\author{Petr Holub, Jan Růžička, Miloš Liška, Martin Šrom, Ondřej Pavelka, Ondřej Bouda}
\date{\copyright~CESNET~z.\,s.\,p.\,o.\\2012}

\maketitle

\tableofcontents

\chapter{Use Cases}

\section{Reservations}

\begin{UseCases}

\UseCase{Types of specifications}{rsv:specifications}

Specification of a resource, being object of a reservation, may be of the
following types:

\begin{compactitem}

\item a \emph{fully-qualified explicit specification (FQESpec)} -- specifies
exactly one element; it ma refer to a specific device (e.g., H.323 endpoint,
web browser as an endpoint for Adobe Connect), a specific server (e.g., a
specific Adobe Connect server or H.323 MCU), a specific physical room, or a
specific virtual room (e.g., a specific room running on specific H.323 MCU),

\item a \emph{partially-qualified explicit specification (PQESpec)} --
specifies a class/type of a resource (e.g., H.323 endpoint) and it is up to the
scheduling to find suitable one (combination of availability and access-level
for given user),

\item a \emph{implicit specification (ISpec)} -- the user does not specify such
a resource, but the resource is needed to implement user's request (e.g., if
user specifies Connect and H.323 endpoints, a gateway/connector is needed to
implement the translation; if user specifies multiple H.323 endpoints beyond
MCU-capability of each of them, some MCU is needs to be included).  

\end{compactitem}


\UseCase{One Time reservation}{rsv:reservation:one}

Common type of reservation, where a user requests certain resources for limited
time duration. Unlimited reservations are not assumed by this scenario (see
\UCref{rsv:reservation:permanent}).

Start time of a reservation may be any time in the future or \emph{now}, which
is also called \emph{ad hoc} reservation.

Reserved resources may be given as FQESpec, PQESpec, or ISpec. FQESpec are
either accepted or denied by the scheduler, while other types of the
specifications are looked for their best match. PQESpec may include the
following:

\begin{compactitem}

\item user may request a general endpoint and Shongo should try to find the
closest matching endpoint available to the user (e.g., user requests a H.323
endpoint for a conference since she has no personal endpoint, and she is
assigned a room-based H.323 endpoint provided the room is available),

\end{compactitem}

while examples of ISpec are as follows:

\begin{compactitem}

\item amount of central resources (such as H.323 MCU ports or Connect licenses)
based on specified number of (H.323/SIP or web-browser) participants,

\item any interconnecting elements (e.g., gateways) to interconnect the
endpoints specified by the user; if only part of the endpoints can be
interconnected, the user should be notified what parts can be interconnected
and what parts are disconnected.

\end{compactitem}

Each reservation has to be given a unique identifier that is further used for
any references to it. If the reservation is denied, reasons for denying should
be communicated to the requester. In case that the reservation succeeds, all
the users involved should be notified.


Each reservation has to include:

\begin{compactitem}

\item unique identifier,

\item timespan definition,

\item requester's identifier,

\item name,

\item links to the resources involved, including specification of the amount of resources consumed,

\item list of users involved.

\end{compactitem}



\UseCase{Periodic reservation}{rsv:reservation:periodic}

\UCref{rsv:reservation:one} extended with periodicity. Expressiveness of the
periodicity language should be equivalent to cron plus explicit lists.

\UseCase{Permanent reservation}{rsv:reservation:permanent}

This is specific type of reservation that can be only made by an owner of the
resource as it permanently removes the reserved capacity from the dynamic
Shongo scheduling.

\UseCase{List all the reservations}{rsv:list}

Some querying/filtering language needs to be supported to limit list to

\begin{compactitem}

\item room types (H.323, SIP, Connect, etc.),

\item equipment (be it class of equipment or a specific device).

\item reservation owner(s),

\item users involved (may be humans as well as resources, such as rooms with
equipment) involved in the room as participants.

\end{compactitem}

\UseCase{Modification of a reservation}{rsv:modify}

Any attribute of a reservation may be requested to change. The request may be
accepted or denied by the scheduler. In case of the denial, reasons for denial
should be communicated to the requester. If the modification succeeds, all the
users involved should be notified.

\UseCase{Release/canceling of a reservation}{rsv:release}

All the users involved should be notified.

\UseCase{Migration of a reservation}{rsv:migration}

If the change is visible to the users (e.g., typically this would include
change of the server/MCU the users connect to), all the users involved should
be notified.

\UseCase{Notification of participants}{rsv:notification}

In case of making, modifying, or canceling a reservation, all the users
involved should be notified, as specified in \UCref{rsv:reservation:one},
\UCref{rsv:reservation:periodic}, \UCref{rsv:reservation:permanent},
\UCref{rsv:modify}, \UCref{rsv:release}, and \UCref{rsv:migration}. By default,
the users should be notified via email, but it would be interesting to provide
also SMS notification service.

\UseCase{Reservations of rooms, public or semi-private endpoints,
etc.}{rsv:service-users}

Each reservation may include endpoint resources (beyond human users with
private endpoints---H.323/SIP/web), which represent entities such as rooms,
non-personal endpoints, etc., that can be scheduled in a similar way to central
resources.

This type of reservation may be either part of some infrastructure reservation
(see \UCref{rsv:reservation:one}, \UCref{rsv:reservation:periodic},
\UCref{rsv:reservation:permanent}) or standalone reservation (e.g., reservation
of a meeting room with H.323 equipment to disable the room from scheduling for
given time duration).


\UseCase{Reservation of recording capacity}{rsv:recording}

Usually part of some infrastructure reservation (see
\UCref{rsv:reservation:one}, \UCref{rsv:reservation:periodic},
\UCref{rsv:reservation:permanent}), but may be completely standalone in case
that only recording server is used of the Shongo-managed infrastructure.


\UseCase{Reservation of streaming capacity}{rsv:streaming}

May part of some infrastructure reservation (see \UCref{rsv:reservation:one},
\UCref{rsv:reservation:periodic}, \UCref{rsv:reservation:permanent}), but may
be completely standalone in case that only streaming server is used of the
Shongo-managed infrastructure.

\end{UseCases}


\section{Operations}

\begin{UseCases}

\UseCase{Live migration of a virtual room}{ops:migration}

This use case is intended for migration due to planned server maintenance or
unplanned server outage.  Ideally, all the room settings and content should be
transferred to the target room---but some content may be lost in case of
unplanned server failure (namely content migration).

Being able to transfer room settings to another server in case of unplanned
failure also requires that the settings needs to be stored in the Shongo
middleware.

Clients should be automatically redirected to the new server, if technology
permits, or at least notified of the migration (email, SMS---see
\UCref{rsv:notification}).

Some functionality will be common~\UCref{rsv:migration}.

\end{UseCases}

\subsection{Room Management}

\begin{UseCases}

\UseCase{Get room information on Shongo level}{ops:room:shongo-options}

This information typically includes name, owner, duration and type.


\UseCase{List users}{ops:room:users-list}

Each user should be given a unique identifier in the output list that can be
used for further querying. It should also provide means to identify the same
user (e.g., if the user disconnects--reconnects, it should contain a part that
is common and that denotes the specific user and a part that is specific for
the session, so that if the user is connected twice (one session is in timeout
state and the other session has just been established), we can differentiate
between the two sessions).

\UseCase{Print detailed info about a user in a room}{ops:room:user-info}

Print all the statistics we can get about a user participating in the room. It
should contain technology agnostic part (e.g., when the user joined) and
technology specific part (i.e., H.323 statistics, H.245/SIP capabilities
negotiation info, H.239 content information, etc.).

\UseCase{Set room layout}{ops:room:layout}

Shongo should be able to set up global layout of a room and user-specific
layout, if available through API of virtual room provider.

\UseCase{Disconnect a user}{ops:room:user-disconnect}

Immediate disconnection of a user.

\UseCase{Disable H.239 content from a specific user}{ops:room:disable-user-content}

Disable content the user to be H.239 content provider for the given room. 

\UseCase{Enable H.239 content only from a specific user}{ops:room:specific-user-content}

Enable H.239 content only from the specific user, typically by disabling
content from all other users. Normally, users may fight who is going to be the
content provider.

\UseCase{Mute a user}{ops:room:user-mute} Mutes user on the room level.
Optionally if user's endpoint is also controlled by Shongo, it should provide
means to mute the endpoint (which can be easily unmuted by the user).

\UseCase{Set microphone audio level for a user}{ops:room:user-miclevel}

Sets the audio from the user on the room level. Optionally, if user's endpoint
is also controlled by Shongo, it should provide means to control mic level on
the endpoint. In this case, audio should be normalized on the endpoint before
doing modifications on room level (if the sound is too low or too high and
distorted, it may not be corrected on the MCU).

\UseCase{Set playback audio level for a user}{ops:room:user-playlevel}

This functionality is typically available only when user's endpoint is also
controlled by Shongo.

\UseCase{Disable video of a user}{ops:room:user-video-off}

\UseCase{Video snapshot for a user}{ops:room:user-video-snap}

If provided by the room provider (MCU, web conferencing, etc.), we should be
able to get video snapshot of:

\begin{compactitem}

\item video sent by the user,

\item video received by the user.

\end{compactitem}


\UseCase{Set layout specific for a user}{ops:room:user-layout}

\UseCase{Download and upload room settings}{ops:room:settings-down-up}

We should provide an API that allows for downloading settings of the room to
the maximum extent possible, in order to back it up and reupload it later on.
This is a convenient way to back up setting as well as to reset a newly created
room (e.g., as a part of a new reservation) to old settings.

\UseCase{Download and upload room content (if technology
permits)}{ops:room:content-down-up}

If technology and access policy permits, we should be able to download and
upload content of the room (e.g., documents, notes, polls, etc.). See
\UCref{ops:room:settings-down-up}.

\UseCase{Get/set technology-specific properties for a
room}{ops:room:room-techspec}

This may include specific attributes of the room (typically on room provider
level), such as enabled codecs.

\UseCase{Get/set technology-specific properties for a
user}{ops:room:user-techspec}

\end{UseCases}


\section{Monitoring \& Management}

\subsection{Shongo management and monitoring}

\begin{UseCases}

\UseCase{List of all the agents in the system}{mgmt:shng:list-agents}

The listing API must including querying language that allows selection of only
a subset based on similar properties like those defined in \UCref{rsv:list}.

\UseCase{List primary and backup controllers}{mgmt:shng:list-controllers}

List all the controllers (primary and backup) for current domain.

\UseCase{List domains}{mgmt:shng:list-domains}

List of all other known domains including references to their domain
controllers and state of connections to them.

\end{UseCases}

\subsection{Server management and monitoring}

\begin{UseCases}

\UseCase{Get server load}{mgmt:srv:get-load}

The API should provide means to get load on the server machine, containing at
least the following:

\begin{compactitem}

\item CPU load

\item memory load

\item disk occupancy

\end{compactitem}

Obviously, this information may or may not be available for specific device.
In case that the information is not available, the API should report this in a
consistent way (specific exception or unique return value).


\UseCase{Schedule server downtime}{mgmt:srv:schedule-downtime}

Downtime scheduling must include change/migration of all the reservations and
live events influenced by the downtime.


\end{UseCases}



\chapter{User Interface API Specification}

\chapter{Connector API Specification}

\section{Data Types}

\begin{APIdef}

\APIcmd{Date}

\APIcmd{Reservation}

\end{APIdef}


\section{Reservation API}

\begin{APIdef}

\APIcmd{Reservation makeReservation(Date date, int licenseCount)}

\end{APIdef}




\section{User Management API}

\begin{itemize}

\item

\end{itemize}


\section{Monitoring API}

\begin{itemize}

\item 

\end{itemize}


\section{Application Specific API}

\begin{itemize}

\item

\end{itemize}


\chapter{Inter-Controller API Specification}



\end{document}

